<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é¹¿ğŸ¦Œçš„QAç¶²ç«™</title>
  <meta name="theme-color" content="#0f1220" />
  <link rel="icon" type="image/png" href="ç¶²ç«™é ‚ç«¯icon.JPG">
  <link rel="stylesheet" href="styles.css?v=20251008" />
  <style>
    /* å³ä¸Šè§’åŠŸèƒ½ç¾¤ */
    .top-actions{position:absolute;right:24px;top:22px;display:flex;gap:10px;align-items:center}
    .btn.icon{display:inline-flex;align-items:center;gap:8px;padding:8px 14px}
    .btn.icon svg{width:18px;height:18px}
    /* å…¬å‘Šéˆ´éºç´…é» */
    #site-bell[data-has]::after{
      content:attr(data-has);position:absolute;top:-6px;right:-6px;background:#ff4d4f;color:#fff;
      font-size:.72rem;line-height:1;padding:2px 6px;border-radius:999px;box-shadow:0 0 0 2px #070b16;
    }
    /* å…¬å‘Šåˆ—è¡¨ */
    .ann-list{display:grid;gap:12px}
    .ann-item{background:linear-gradient(180deg,var(--card) 0%, var(--card2) 100%);
      border:1px solid rgba(255,255,255,.10);border-radius:12px;padding:12px}
    .ann-item h4{margin:.2rem 0}.ann-item .meta{font-size:.85rem;color:var(--muted)}
    /* å½±ç‰‡å®¹å™¨ï¼šæ‰‹æ©Ÿå¯è¦‹ã€16:9 è‡ªé©æ‡‰ */
    .video-embed{position:relative;width:100%;padding-top:56.25%;border-radius:14px;overflow:hidden;background:#0b0f1e}
    .video-embed>iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
    /* AIè¨Šæ¯ï¼šå·¦å³æ’åˆ—ã€é¿å…è¶…å‡ºã€é•·å­—æ›è¡Œ */
    .ai-messages{display:flex;flex-direction:column;gap:8px;padding:12px}
    .msg{display:flex;align-items:flex-end;gap:8px;width:100%}
    .msg .body{max-width:100%}
    .msg .bubble{
      display:inline-block;width:fit-content;max-width:72%;
      padding:10px 12px;border-radius:12px;line-height:1.5;
      word-break:break-word;overflow-wrap:anywhere;
    }
    .msg.assistant{justify-content:flex-start}
    .msg.assistant .bubble{background:#1b2a58;color:#fff}
    .msg.user{justify-content:flex-end}
    .msg.user .bubble{background:#0f2748;color:#fff}
    @media (max-width:360px){.msg .bubble{max-width:86%}}
    /* iOS 100vh ä¿®æ­£å¯ç”¨ï¼šheight:calc(var(--vh)*100)ï¼›æ­¤é é¢ä¸»è¦ç”±å¤–éƒ¨ CSS æ§åˆ¶ */
  </style>
</head>
<body>
  <!-- Loading -->
<div id="page-loading">
  <div class="card">
    <div class="spinner">
      <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
    <div class="title">ç¶²é è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™â€¦</div>
    <div class="muted" style="font-size:.9rem">æ­£åœ¨æº–å‚™è³‡æ–™èˆ‡ä»‹é¢</div>
  </div>
</div>
  <!-- ç‰ˆæœ¬ç´€éŒ„ï¼ˆä¿ç•™ç¯€é»ï¼Œä¸è‡ªå‹•å½ˆå‡ºï¼‰ -->
  <div id="changelog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="cg-title">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="cg-title">ğŸ¦Œ ç¶²ç«™æ›´æ–°</h2>
        <button id="cg-close" class="btn ghost">æˆ‘çŸ¥é“äº†ï¼Œé—œé–‰è¦–çª—âŒ</button>
      </div>
      <div class="modal-body" id="cg-body"></div>
    </div>
  </div>

  <!-- å…¬å‘Šï¼ˆä¿ç•™ç¯€é»ï¼Œä¸è‡ªå‹•å½ˆå‡ºï¼‰ -->
  <div id="ann-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="ann-title">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="ann-title">ç¶²ç«™å…¬å‘Š</h2>
        <button id="ann-close" class="btn ghost">âŒé—œé–‰å…¬å‘Š</button>
      </div>
      <div class="modal-body" id="ann-body"></div>
    </div>
  </div>

  <header class="hero">
    <div class="brand">
      <img id="logo-img" src="Logo.png" class="logo-img" alt="é¹¿ Logo" />
      <div>
        <h1>é¹¿ğŸ¦Œçš„QAç¶²ç«™</h1>
        <p class="muted">æŸ¥è©¢è³‡æ–™åº«èˆ‡è§€çœ‹å½±ç‰‡ã€‚è‹¥æœ‰éŒ¯èª¤ï¼Œè«‹å›å ±å·¥ç¨‹å¸«ã€‚</p>
      </div>
    </div>

    <div class="top-actions">
      <button id="site-bell" class="btn ghost icon" title="å…¬å‘Š" aria-label="å…¬å‘Š">ğŸ””<span class="muted" style="font-size:.9rem">å…¬å‘Š</span></button>
      <button id="site-share" class="btn icon share-top" title="åˆ†äº«ç¶²ç«™" aria-label="åˆ†äº«ç¶²ç«™">
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M15 8a3 3 0 1 0-2.83-4H12a3 3 0 0 0 3 4zm-6 8a3 3 0 1 0 2.83 4H12a3 3 0 0 0-3-4zm9-1-8.1-4.05a4 4 0 0 1-1.53.95L16.5 16A3 3 0 0 0 18 15zM6 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
        åˆ†äº«
      </button>
      <a id="contact-eng" class="btn ghost icon" href="mailto:wanglien214@gmail.com" title="è¯çµ¡å·¥ç¨‹å¸«" aria-label="è¯çµ¡å·¥ç¨‹å¸«">
        ğŸ“§ <span class="muted" style="font-size:.9rem">è¯çµ¡å·¥ç¨‹å¸«</span>
      </a>
    </div>

    <nav class="tabs" role="tablist" aria-label="ä¸»è¦åŠŸèƒ½">
      <button id="tab-qa" class="tab active" role="tab" aria-selected="true" aria-controls="qa-panel">QA</button>
      <button id="tab-video" class="tab" role="tab" aria-selected="false" aria-controls="video-panel">å½±ç‰‡</button>
    </nav>

    <div id="qa-toolbar" class="search-wrap">
      <input id="search" class="input" type="search" placeholder="è¼¸å…¥é—œéµå­—ï¼ˆå‚³çµ±æ¯”å°ï¼‰" aria-label="æœå°‹ QA" />
      <button id="clear" class="btn ghost">æ¸…é™¤</button>
    </div>

    <div class="stats" id="qa-stats">
      <div class="stat"><span id="stat-total" class="value">0</span><span class="label">ç¸½ç­†æ•¸</span></div>
      <div class="stat"><span id="stat-page" class="value">1</span><span class="label">ç›®å‰é </span></div>
      <div class="stat"><span id="stat-pages" class="value">1</span><span class="label">ç¸½é æ•¸</span></div>
      <div class="stat"><span id="stat-filtered" class="value">0</span><span class="label">ç›®å‰ç¯©é¸</span></div>
    </div>
  </header>

  <main class="container">
    <!-- QA -->
    <section id="qa-panel" class="tabpanel" role="tabpanel" aria-labelledby="tab-qa">
      <section id="qa-list" class="accordion"></section>
      <nav class="pager" aria-label="åˆ†é å°è¦½">
        <button id="prev" class="btn">ä¸Šä¸€é </button>
        <input id="page" class="page-input" type="text" inputmode="numeric" pattern="[0-9]*" value="1" aria-label="è·³è‡³é ç¢¼">
        <span class="slash">/</span>
        <span id="pages" class="pages-badge">1</span>
        <button id="next" class="btn">ä¸‹ä¸€é </button>
      </nav>
      <footer class="footer" aria-hidden="true" style="visibility:hidden;height:0;padding:0;margin:0"></footer>
    </section>

    <!-- å½±ç‰‡ -->
    <section id="video-panel" class="tabpanel hidden" role="tabpanel" aria-labelledby="tab-video">
      <div class="video-layout">
        <div class="video-left">
          <div class="video-controls top">
            <button id="v-random" class="btn">éš¨æ©Ÿå½±ç‰‡</button>
          </div>
          <div class="video-header">
            <span id="v-title" class="video-title">æœªé¸æ“‡å½±ç‰‡</span>
            <button id="v-info-btn" class="info-btn" title="å½±ç‰‡è³‡è¨Š">â„¹ï¸</button>
          </div>
          <div id="v-frame" class="video-frame"></div>
        </div>
        <div class="video-right" id="v-list"></div>
      </div>
    </section>
  </main>

  <!-- å½±ç‰‡è³‡è¨Š Modalï¼ˆä¿ç•™ï¼Œä¸è‡ªå‹•å½ˆï¼‰ -->
  <div id="info-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card small">
      <div class="modal-header">
        <h3>å½±ç‰‡è³‡è¨Š</h3>
        <button id="modal-close" class="btn ghost">âŒé—œé–‰å½±ç‰‡è³‡è¨Š</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <!-- AIéº‹é¹¿ -->
  <button id="ai-fab" class="ai-fab" aria-label="é–‹å•Ÿ AI éº‹é¹¿">
    <svg width="26" height="26" viewBox="0 0 24 24"><path fill="currentColor" d="M4 4h16v10H7l-3 3V4z"/><circle cx="9" cy="9" r="1.5" fill="#0f1220"/><circle cx="14" cy="9" r="1.5" fill="#0f1220"/></svg>
  </button>

  <aside id="ai-panel" class="ai-panel hidden" role="dialog" aria-modal="true" aria-labelledby="ai-title">
    <header class="ai-header"><h2 id="ai-title">AIéº‹é¹¿</h2><button id="ai-close" class="btn ghost" aria-label="é—œé–‰">âŒé—œé–‰èŠå¤©å®¤</button></header>
    <div id="ai-messages" class="ai-messages"></div>
    <form id="ai-form" class="ai-input" autocomplete="off">
      <input id="ai-text" class="input ai-inputbox" placeholder="è¼¸å…¥ä¸¦æŒ‰ Enter é€å‡º" aria-label="AIè¼¸å…¥">
      <div style="display:flex;gap:8px">
        <button id="ai-mic" class="btn ghost" type="button" title="èªéŸ³è¼¸å…¥">ğŸ™ï¸</button>
        <button id="ai-tts" class="btn ghost" type="button" title="èªéŸ³æœ—è®€">ğŸ”Š</button>
        <button class="btn primary" type="submit">é€å‡º</button>
      </div>
    </form>
  </aside>

  <!-- æ—¢æœ‰è…³æœ¬ -->
  <script src="deer-qa.js"></script>
  <script src="app.js"></script>
  <script src="qa-accordion-fix.js"></script>
  <script src="deer-video-min.js"></script>

  <!-- é å…§è£œå¼·è…³æœ¬ï¼ˆéƒ½æ”¾æœ€å¾Œï¼Œè¦†è“‹èˆŠè¡Œç‚ºï¼‰ -->
  <script>
/* ========= åŸºç¤å·¥å…· ========= */
window.escapeHTML ||= (s)=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
window.scrollBottom ||= function(){ const m=document.getElementById('ai-messages'); if(m) m.scrollTop=m.scrollHeight; };

/* ========= Loadingï¼šè½‰åœˆåœˆé¡¯ç¤º/é—œé–‰ ========= */
/* å°è£œï¼šç¢ºä¿æœ‰æ·¡å‡ºå‹•ç•« */
(function ensureLoaderStyles(){
  const css = `
    #page-loading{opacity:1;transition:opacity .35s ease}
    #page-loading.hide{opacity:0;pointer-events:none}
  `;
  const style = document.createElement('style'); style.textContent = css; document.head.appendChild(style);
})();
function hideLoader(){
  const l=document.getElementById('page-loading'); if(!l) return;
  l.classList.add('hide'); setTimeout(()=>l.remove(), 420);
}
window.addEventListener('load', hideLoader);
/* ä¿éšªï¼šè‹¥æŸäº›è³‡æºé˜»å¡ï¼Œ2.5 ç§’ä¹Ÿæœƒè‡ªå‹•é—œ */
document.addEventListener('DOMContentLoaded', ()=>{ setTimeout(hideLoader, 2500); });

/* ========= åªå…è¨±æ•¸å­—çš„é ç¢¼è¼¸å…¥ ========= */
const pageInput = document.getElementById('page');
pageInput?.addEventListener('input',()=>{ pageInput.value = pageInput.value.replace(/[^\d]/g,''); });

/* ========= æ¡Œæ©Ÿè‡ªå‹•å±•é–‹èŠå¤©é¢æ¿ ========= */
document.addEventListener('DOMContentLoaded',()=>{ if (window.matchMedia('(min-width:1024px)').matches) { window.openAI?.(); } });

/* ========= å–®ä¾‹ Overlayï¼ˆå…¬å‘Š/ç‰ˆæœ¬/ä¿¡å¿ƒå…±ç”¨ï¼‰ ========= */
const Overlay = (() => {
  let el = null, lock = 0;
  const lockBody = () => { if(!lock){ document.body.style.overflow='hidden'; } lock++; };
  const unlockBody = () => { lock=Math.max(0,lock-1); if(!lock){ document.body.style.overflow=''; } };
  function ensure(){
    if(el) el.remove();
    el = document.createElement('div');
    el.id='overlay-modal'; el.role='dialog'; el.ariaModal='true';
    el.style.cssText=`position:fixed;inset:0;z-index:99999;background:rgba(5,8,16,.68);backdrop-filter:blur(18px);display:grid;place-items:center`;
    el.innerHTML=`
      <div class="modal-card small" style="width:min(560px,92vw);background:linear-gradient(180deg,var(--card) 0%, var(--card2) 100%);border:1px solid rgba(255,255,255,.14);border-radius:20px;box-shadow:var(--shadow);">
        <div class="modal-header" style="display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.10)">
          <h2 class="title" style="margin:0;font-size:1.05rem">è¨Šæ¯</h2>
          <button id="ov-close" class="btn ghost">é—œé–‰</button>
        </div>
        <div id="ov-body" class="modal-body" style="padding:16px"></div>
      </div>`;
    document.body.appendChild(el);
    lockBody();
    el.addEventListener('click',e=>{ if(e.target===el) Overlay.close(); });
    el.querySelector('#ov-close').addEventListener('click',Overlay.close);
    return el;
  }
  return {
    open({title='è¨Šæ¯',html=''}){ const box=ensure(); box.querySelector('.title').textContent=title; box.querySelector('#ov-body').innerHTML=html; },
    close(){ if(el){ el.remove(); el=null; unlockBody(); } },
    isOpen(){ return !!el; }
  };
})();

/* ========= å…¬å‘Šï¼šé»éˆ´éºæ‰é–‹ ========= */
(function wireAnnouncements(){
  const ANNOUNCEMENTS=[{id:'welcome-410',title:'V4.1 ä¸Šç·š',body:'4.1æ”¯æ´èªéŸ³è¼¸å…¥èˆ‡æœ—è®€ï¼Œé»å³ä¸‹è§’ AI è©¦è©¦çœ‹ã€‚',start:'2025-10-07T00:00:00+08:00'}];
  const bell=document.getElementById('site-bell');
  const now=Date.now();
  const isActive=a=>{const st=a.start?new Date(a.start).getTime():-Infinity;const ed=a.end?new Date(a.end).getTime():Infinity;return now>=st&&now<=ed;};
  const active=ANNOUNCEMENTS.filter(isActive);
  if(active.length) bell?.setAttribute('data-has',active.length); else bell?.removeAttribute('data-has');
  bell?.addEventListener('click',()=>{
    const html = active.length
      ? `<div class="ann-list">${active.map(a=>`
          <article class="ann-item">
            <h4>${a.title}</h4>
            <div class="meta">${(a.start||'').slice(0,10)}${a.end?` â€” ${a.end.slice(0,10)}`:''}</div>
            <p>${a.body}</p>
          </article>`).join('')}</div>`
      : `<p class="muted">ç›®å‰æ²’æœ‰å…¬å‘Šã€‚</p>`;
    Overlay.open({title:'ç¶²ç«™å…¬å‘Š', html});
  });
})();

/* ========= åˆ†äº« ========= */
(function wireShare(){
  const btn=document.getElementById('site-share');
  btn?.addEventListener('click', async ()=>{
    const data={title:document.title,text:'é¹¿ğŸ¦Œçš„QAç¶²ç«™',url:location.href};
    try{ if(navigator.share){ await navigator.share(data); } else { await navigator.clipboard.writeText(location.href); btn.textContent='å·²è¤‡è£½é€£çµ'; setTimeout(()=>btn.textContent='åˆ†äº«',1200);} }catch{}
  });
})();

/* ========= iOS 100vh ä¿®æ­£ ========= */
const setVH=()=>document.documentElement.style.setProperty('--vh', window.innerHeight*0.01+'px');
window.addEventListener('resize', setVH); setVH();

/* ========= å½±ç‰‡æ¸…å–®ï¼šé»ä¸€æ¬¡åªæ¸²æŸ“ä¸€æ¬¡ ========= */
const videoList = document.getElementById('v-list');
const videoFrame = document.getElementById('v-frame');
const videoTitle = document.getElementById('v-title');
let selectingVideo = false;
videoList?.addEventListener('click', (e)=>{
  const item=e.target.closest('[data-video]'); if(!item||selectingVideo) return; selectingVideo=true;
  try{
    const data=JSON.parse(item.dataset.video||'{}');  // {title,url,desc}
    // æ¸…ç©ºèˆŠå…§å®¹ â†’ å¡æ–° iframeï¼ˆåªåšä¸€æ¬¡ï¼‰
    videoFrame.innerHTML='';
    const wrap=document.createElement('div'); wrap.className='video-embed';
    wrap.innerHTML=`<iframe src="${data.url||''}" allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>`;
    videoFrame.appendChild(wrap);
    if(videoTitle) videoTitle.textContent=data.title||'å½±ç‰‡';
  }finally{ selectingVideo=false; }
});

/* ========= åˆ†é ï¼šæ›é å¾Œå›åˆ°æœ€ä¸Šé¢ ========= */
document.getElementById('prev')?.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
document.getElementById('next')?.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
document.getElementById('page')?.addEventListener('change',()=>window.scrollTo({top:0,behavior:'smooth'}));

/* ========= èªéŸ³ï¼šéº¥å…‹é¢¨(STT) + å–‡å­(TTS) ========= */
const Voice = {
  rec:null, recOn:false, ttsOn:false,
  init(){
    /* STTï¼šSpeechRecognition */
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(SR){
      this.rec = new SR();
      this.rec.lang='zh-TW';
      this.rec.interimResults=false;
      this.rec.continuous=false;
      this.rec.addEventListener('result',(e)=>{
        const text = Array.from(e.results).map(r=>r[0].transcript).join('').trim();
        const input = document.getElementById('ai-text'); if(input) input.value = text;
        document.getElementById('ai-form')?.dispatchEvent(new Event('submit',{cancelable:true,bubbles:true}));
      });
      this.rec.addEventListener('end',()=>{ this.recOn=false; document.getElementById('ai-mic')?.classList.remove('rec'); });
    }
    document.getElementById('ai-mic')?.addEventListener('click',()=>this.toggleRec());

    /* TTSï¼šspeechSynthesis */
    document.getElementById('ai-tts')?.addEventListener('click',()=>this.toggleTTS());

    /* ç›£è½èŠå¤©å®¤è¨Šæ¯ï¼šæ–° AI æ³¡æ³¡å‡ºç¾æ™‚è‡ªå‹•æœ—è®€ï¼ˆé¿å…ä¾è³´å¤–éƒ¨äº‹ä»¶ï¼‰ */
    const list = document.getElementById('ai-messages');
    if(list){
      const obs = new MutationObserver(()=>{
        if(!this.ttsOn) return;
        const last = list.querySelector('.msg.assistant:last-of-type .bubble');
        const text = last?.textContent?.trim(); if(text) this.speak(text);
      });
      obs.observe(list, { childList:true, subtree:true });
    }
  },
  toggleRec(){
    if(!this.rec){ alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥'); return; }
    if(this.recOn){ this.rec.stop(); this.recOn=false; document.getElementById('ai-mic')?.classList.remove('rec'); return; }
    try{ this.rec.start(); this.recOn=true; document.getElementById('ai-mic')?.classList.add('rec'); }catch{}
  },
  toggleTTS(){
    this.ttsOn=!this.ttsOn;
    const btn=document.getElementById('ai-tts');
    btn?.classList.toggle('on', this.ttsOn);
    if(!this.ttsOn && 'speechSynthesis' in window) speechSynthesis.cancel();
  },
  speak(text){
    if(!('speechSynthesis' in window)) return;
    const u = new SpeechSynthesisUtterance(text);
    const pick=(voices)=>{
      const v = voices.find(v=>/zh[-_]?TW/i.test(v.lang)) || voices.find(v=>/zh/i.test(v.lang)) || voices[0];
      if(v) u.voice=v; speechSynthesis.speak(u);
    };
    const voices = speechSynthesis.getVoices();
    if(voices.length) pick(voices);
    else speechSynthesis.addEventListener('voiceschanged', function onv(){ speechSynthesis.removeEventListener('voiceschanged', onv); pick(speechSynthesis.getVoices()); });
  }
};
document.addEventListener('DOMContentLoaded', ()=>Voice.init());

/* ========= æ‰‹æ©Ÿè¼¸å…¥æ™‚æ»¾åº•ï¼Œæ¸›å°‘è·³å‹• ========= */
document.getElementById('ai-text')?.addEventListener('focus',()=>setTimeout(scrollBottom,50));
</script>
</body>
</html>