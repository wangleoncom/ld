<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é¹¿ğŸ¦Œçš„QAç¶²ç«™</title>
  <meta name="theme-color" content="#0f1220" />
  <link rel="icon" type="image/png" href="ç¶²ç«™é ‚ç«¯icon.JPG">
  <link rel="stylesheet" href="styles.css?v=20251008" />
</head>
<body>
  <!-- Loading -->
  <div id="page-loading">
  <div class="card">
    <div class="spinner">
      <img src="è½‰åœˆåœˆ.png" alt="è¼‰å…¥ä¸­" class="loading-img">
    </div>
    <div class="title">ç¶²é è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™â€¦</div>
    <div class="muted" style="font-size:.9rem">æ­£åœ¨æº–å‚™è³‡æ–™èˆ‡ä»‹é¢</div>
  </div>
</div>

  <!-- ç‰ˆæœ¬ç´€éŒ„ï¼ˆä¿ç•™ç¯€é»ï¼Œä¸è‡ªå‹•å½ˆå‡ºï¼‰ -->
  <div id="changelog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="cg-title">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="cg-title">ğŸ¦Œ ç¶²ç«™æ›´æ–°</h2>
        <button id="cg-close" class="btn ghost">æˆ‘çŸ¥é“äº†ï¼Œé—œé–‰è¦–çª—âŒ</button>
      </div>
      <div class="modal-body" id="cg-body"></div>
    </div>
  </div>

  <!-- å…¬å‘Šï¼ˆä¿ç•™ç¯€é»ï¼Œä¸è‡ªå‹•å½ˆå‡ºï¼‰ -->
  <div id="ann-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="ann-title">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="ann-title">ç¶²ç«™å…¬å‘Š</h2>
        <button id="ann-close" class="btn ghost">âŒé—œé–‰å…¬å‘Š</button>
      </div>
      <div class="modal-body" id="ann-body"></div>
    </div>
  </div>

  <header class="hero">
    <div class="brand">
      <img id="logo-img" src="Logo.png" class="logo-img" alt="é¹¿ Logo" />
      <div>
        <h1>é¹¿ğŸ¦Œçš„QAç¶²ç«™</h1>
        <p class="muted">æŸ¥è©¢è³‡æ–™åº«èˆ‡è§€çœ‹å½±ç‰‡ã€‚è‹¥æœ‰éŒ¯èª¤ï¼Œè«‹å›å ±å·¥ç¨‹å¸«ã€‚</p>
      </div>
    </div>

    <div class="top-actions">
      <button id="site-bell" class="btn ghost icon" title="å…¬å‘Š" aria-label="å…¬å‘Š">ğŸ””<span class="muted" style="font-size:.9rem">å…¬å‘Š</span></button>
      <button id="site-share" class="btn icon share-top" title="åˆ†äº«ç¶²ç«™" aria-label="åˆ†äº«ç¶²ç«™">
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M15 8a3 3 0 1 0-2.83-4H12a3 3 0 0 0 3 4zm-6 8a3 3 0 1 0 2.83 4H12a3 3 0 0 0-3-4zm9-1-8.1-4.05a4 4 0 0 1-1.53.95L16.5 16A3 3 0 0 0 18 15zM6 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
        åˆ†äº«
      </button>
      <a id="contact-eng" class="btn ghost icon" href="mailto:wanglien214@gmail.com" title="è¯çµ¡å·¥ç¨‹å¸«" aria-label="è¯çµ¡å·¥ç¨‹å¸«">
        ğŸ“§ <span class="muted" style="font-size:.9rem">è¯çµ¡å·¥ç¨‹å¸«</span>
      </a>
    </div>

    <nav class="tabs" role="tablist" aria-label="ä¸»è¦åŠŸèƒ½">
      <button id="tab-qa" class="tab active" role="tab" aria-selected="true" aria-controls="qa-panel">QA</button>
      <button id="tab-video" class="tab" role="tab" aria-selected="false" aria-controls="video-panel">å½±ç‰‡</button>
    </nav>

    <div id="qa-toolbar" class="search-wrap">
      <input id="search" class="input" type="search" placeholder="è¼¸å…¥é—œéµå­—ï¼ˆå‚³çµ±æ¯”å°ï¼‰" aria-label="æœå°‹ QA" />
      <button id="clear" class="btn ghost">æ¸…é™¤</button>
    </div>

    <div class="stats" id="qa-stats">
      <div class="stat"><span id="stat-total" class="value">0</span><span class="label">ç¸½ç­†æ•¸</span></div>
      <div class="stat"><span id="stat-page" class="value">1</span><span class="label">ç›®å‰é </span></div>
      <div class="stat"><span id="stat-pages" class="value">1</span><span class="label">ç¸½é æ•¸</span></div>
      <div class="stat"><span id="stat-filtered" class="value">0</span><span class="label">ç›®å‰ç¯©é¸</span></div>
    </div>
  </header>

  <main class="container">
    <!-- QA -->
    <section id="qa-panel" class="tabpanel" role="tabpanel" aria-labelledby="tab-qa">
      <section id="qa-list" class="accordion"></section>
      <nav class="pager" aria-label="åˆ†é å°è¦½">
        <button id="prev" class="btn">ä¸Šä¸€é </button>
        <input id="page" class="page-input" type="text" inputmode="numeric" pattern="[0-9]*" value="1" aria-label="è·³è‡³é ç¢¼">
        <span class="slash">/</span>
        <span id="pages" class="pages-badge">1</span>
        <button id="next" class="btn">ä¸‹ä¸€é </button>
      </nav>
      <footer class="footer" aria-hidden="true" style="visibility:hidden;height:0;padding:0;margin:0"></footer>
    </section>

    <!-- å½±ç‰‡ -->
    <section id="video-panel" class="tabpanel hidden" role="tabpanel" aria-labelledby="tab-video">
      <div class="video-layout">
        <div class="video-left">
          <div class="video-controls top">
            <button id="v-random" class="btn">éš¨æ©Ÿå½±ç‰‡</button>
          </div>
          <div class="video-header">
            <span id="v-title" class="video-title">æœªé¸æ“‡å½±ç‰‡</span>
            <button id="v-info-btn" class="info-btn" title="å½±ç‰‡è³‡è¨Š">â„¹ï¸</button>
          </div>
          <div id="v-frame" class="video-frame"></div>
        </div>
        <div class="video-right" id="v-list"></div>
      </div>
    </section>
  </main>

  <!-- å½±ç‰‡è³‡è¨Š Modalï¼ˆä¿ç•™ï¼Œä¸è‡ªå‹•å½ˆï¼‰ -->
  <div id="info-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card small">
      <div class="modal-header">
        <h3>å½±ç‰‡è³‡è¨Š</h3>
        <button id="modal-close" class="btn ghost">âŒé—œé–‰å½±ç‰‡è³‡è¨Š</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <!-- AIéº‹é¹¿ -->
  <button id="ai-fab" class="ai-fab" aria-label="é–‹å•Ÿ AI éº‹é¹¿">
    <svg width="26" height="26" viewBox="0 0 24 24"><path fill="currentColor" d="M4 4h16v10H7l-3 3V4z"/><circle cx="9" cy="9" r="1.5" fill="#0f1220"/><circle cx="14" cy="9" r="1.5" fill="#0f1220"/></svg>
  </button>

  <aside id="ai-panel" class="ai-panel hidden" role="dialog" aria-modal="true" aria-labelledby="ai-title">
    <header class="ai-header"><h2 id="ai-title">AIéº‹é¹¿</h2><button id="ai-close" class="btn ghost" aria-label="é—œé–‰">âŒé—œé–‰èŠå¤©å®¤</button></header>
    <div id="ai-messages" class="ai-messages"></div>
    <form id="ai-form" class="ai-input" autocomplete="off">
      <input id="ai-text" class="input ai-inputbox" placeholder="è¼¸å…¥ä¸¦æŒ‰ Enter é€å‡º" aria-label="AIè¼¸å…¥">
      <div style="display:flex;gap:8px">
        <button id="ai-mic" class="btn ghost" type="button" title="èªéŸ³è¼¸å…¥">ğŸ™ï¸</button>
        <button id="ai-tts" class="btn ghost" type="button" title="èªéŸ³æœ—è®€">ğŸ”Š</button>
        <button class="btn primary" type="submit">é€å‡º</button>
      </div>
    </form>
  </aside>

  <!-- æ—¢æœ‰è…³æœ¬ -->
  <script src="deer-qa.js"></script>
  <script src="app.js"></script>
  <script src="qa-accordion-fix.js"></script>
  <script src="deer-video-min.js"></script>

  <!-- é å…§è£œå¼·è…³æœ¬ï¼ˆéƒ½æ”¾æœ€å¾Œï¼Œè¦†è“‹èˆŠè¡Œç‚ºï¼‰ -->
  <script>
// === QA è¤‡è£½ï¼šè‡ªå‹•è£œä¸Šã€Œè¤‡è£½ã€æŒ‰éˆ•ï¼‹å‹•ç•«ï¼‹Toastï¼‹æ»‘é¼ æ‰‹å‹¢ ===
(function setupQACopy(){
  const list = document.getElementById('qa-list');
  if(!list) return;

  function ensureCopyButtons(root=list){
    root.querySelectorAll('.item').forEach(item=>{
      if(item.querySelector('.tool.copy-qa')) return;
      const header = item.querySelector('.q'); if(!header) return;

      const tools = header.querySelector('.tools') || (()=> {
        const t=document.createElement('div');
        t.className='tools'; t.style.marginLeft='auto';
        t.style.display='flex'; t.style.gap='8px';
        header.appendChild(t); return t;
      })();

      const btn=document.createElement('span');
      btn.className='tool copy-qa';
      btn.setAttribute('role','button');
      btn.setAttribute('tabindex','0');
      btn.title='è¤‡è£½é€™å‰‡ QA';
      btn.textContent='ğŸ“‹ è¤‡è£½';
      tools.appendChild(btn);
    });
  }

  function toastAt(text, rect){
    const tip=document.createElement('div');
    tip.className='toast'; tip.textContent=text;
    const y = Math.max(12, window.scrollY + rect.top - 14);
    const x = Math.min(window.innerWidth-12, Math.max(12, window.scrollX + rect.left + rect.width/2));
    tip.style.top = `${y}px`; tip.style.left = `${x}px`;
    tip.style.transform = 'translate(-50%, 0)';
    document.body.appendChild(tip);
    setTimeout(()=>tip.remove(), 1650);
  }

  async function doCopy(fromEl, btn){
    const item = fromEl.closest('.item');
    const txt = item?.querySelector('.a-inner')?.innerText?.trim();
    if(!txt) return;
    await navigator.clipboard.writeText(txt);
    btn.classList.add('copied');
    setTimeout(()=>btn.classList.remove('copied'), 420);
    toastAt('å·²è¤‡è£½ QA', btn.getBoundingClientRect());
  }

  // äº‹ä»¶ä»£ç†ï¼šé»æ“Šæˆ–éµç›¤æ“ä½œ
  document.addEventListener('click', e=>{
    const btn = e.target.closest('.tool.copy-qa,[data-copy]');
    if(!btn) return;
    e.preventDefault(); doCopy(btn, btn);
  });
  document.addEventListener('keydown', e=>{
    if((e.key==='Enter'||e.key===' ') && e.target.closest('.tool.copy-qa')){
      e.preventDefault(); doCopy(e.target, e.target);
    }
  });

  // åˆæ¬¡èˆ‡å‹•æ…‹æ¸²æŸ“æ™‚éƒ½è£œæŒ‰éˆ•
  ensureCopyButtons();
  const mo=new MutationObserver(muts=>{
    muts.forEach(m=>m.addedNodes.forEach(n=>{
      if(n.nodeType===1) ensureCopyButtons(n);
    }))
  });
  mo.observe(list, {childList:true, subtree:true});
})();

// === å½±ç‰‡ï¼šé»ä¸€æ¬¡åªæ¸²æŸ“ä¸€æ¬¡ï¼ˆé¿å…é€£çºŒå…©å‰‡ç›¸åŒè³‡è¨Šï¼‰ ===
(function videoClickOnce(){
  const list = document.getElementById('v-list');
  const frame = document.getElementById('v-frame');
  const title = document.getElementById('v-title');
  if(!list || !frame) return;
  let lock=false, lastKey='';
  list.addEventListener('click', (e)=>{
    const item=e.target.closest('[data-video]'); if(!item) return;
    if(lock) return; lock=true; setTimeout(()=>lock=false,600);
    try{
      const data=JSON.parse(item.dataset.video||'{}'); // {title,url,desc,id}
      const key = (data.id||data.url||'') + '|' + (data.title||'');
      if(key===lastKey) return; lastKey=key;
      frame.innerHTML='';
      const wrap=document.createElement('div'); wrap.className='video-embed';
      wrap.innerHTML=`<iframe src="${data.url||''}" allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>`;
      frame.appendChild(wrap);
      if(title) title.textContent=data.title||'å½±ç‰‡';
    }catch{}
  }, true);
})();

// === æ›é å¾Œå›åˆ°æœ€ä¸Šé¢ï¼ˆprev/next/ç›´æ¥è¼¸å…¥ï¼‰ ===
['prev','next','page'].forEach(id=>{
  const el=document.getElementById(id);
  if(!el) return;
  const evt = id==='page' ? 'change' : 'click';
  el.addEventListener(evt,()=>window.scrollTo({top:0,behavior:'smooth'}));
});

// === AI è¨Šæ¯å»é‡ï¼ˆç›¸é„°å…©å‰‡ä¸€æ¨£ â†’ ç§»é™¤è¼ƒæ–°çš„é‚£å‰‡ï¼‰ ===
(function dedupeAssistant(){
  const box = document.getElementById('ai-messages');
  if(!box) return;
  let t=null;
  const mo = new MutationObserver(()=>{
    clearTimeout(t);
    t = setTimeout(()=>{
      const bubbles = [...box.querySelectorAll('.msg.assistant .bubble')];
      if(bubbles.length < 2) return;
      const a = bubbles[bubbles.length-2]?.textContent?.trim();
      const b = bubbles[bubbles.length-1]?.textContent?.trim();
      if(a && b && a === b){
        bubbles[bubbles.length-1].closest('.msg.assistant')?.remove();
      }
    }, 50);
  });
  mo.observe(box, {childList:true, subtree:true});
})();

// === èªéŸ³ï¼šåªä¿ç•™é€™å€‹ç‰ˆæœ¬ï¼ˆéº¥å…‹é¢¨/å–‡å­ä¿®å¾©ï¼Œé¿å…é‡è¤‡å®£å‘Šï¼‰ ===
window.Voice ??= (() => {
  let rec = null, recOn = false, ttsOn = false, inited = false;

  function toggleRec(){
    if(!rec){ alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¼¸å…¥'); return; }
    if(recOn){ rec.stop(); recOn=false; btnMic()?.classList.remove('rec'); return; }
    try{ rec.start(); recOn=true; btnMic()?.classList.add('rec'); }catch{}
  }
  function toggleTTS(){
    ttsOn = !ttsOn;
    btnTTS()?.classList.toggle('on', ttsOn);
    if(!('speechSynthesis' in window)) return;
    if(!ttsOn) speechSynthesis.cancel();
    if(ttsOn){
      const txt=lastAssistantText();
      if(txt) speak(txt);
    }
  }
  function lastAssistantText(){
    return document.querySelector('#ai-messages .msg.assistant:last-of-type .bubble')?.textContent?.trim();
  }
  function speak(text){
    if(!('speechSynthesis' in window) || !text) return;
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const useVoice = (voices)=>{
      const v = voices.find(v=>/zh[-_]?TW/i.test(v.lang)) || voices.find(v=>/zh/i.test(v.lang)) || voices[0];
      if(v) u.voice=v; speechSynthesis.speak(u);
    };
    const voices = speechSynthesis.getVoices();
    if(voices.length) useVoice(voices);
    else speechSynthesis.addEventListener('voiceschanged', function onv(){
      speechSynthesis.removeEventListener('voiceschanged', onv);
      useVoice(speechSynthesis.getVoices());
    });
  }

  function btnMic(){ return document.getElementById('ai-mic'); }
  function btnTTS(){ return document.getElementById('ai-tts'); }

  function init(){
    if(inited) return; inited = true;
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(SR){
      rec = new SR();
      rec.lang='zh-TW'; rec.interimResults=false; rec.continuous=false;
      rec.addEventListener('result',(e)=>{
        const text = Array.from(e.results).map(r=>r[0].transcript).join('').trim();
        const input = document.getElementById('ai-text'); if(input) input.value = text;
        document.getElementById('ai-form')?.dispatchEvent(new Event('submit',{cancelable:true,bubbles:true}));
      });
      rec.addEventListener('end',()=>{ recOn=false; btnMic()?.classList.remove('rec'); });
    }
    btnMic()?.addEventListener('click', toggleRec);
    btnTTS()?.addEventListener('click', toggleTTS);

    // æ–°è¨Šæ¯è‡ªå‹•æœ—è®€ï¼ˆç•¶å–‡å­ç‚ºé–‹ï¼‰
    const list=document.getElementById('ai-messages');
    if(list){
      const obs = new MutationObserver(()=>{
        if(!ttsOn) return;
        const txt=lastAssistantText(); if(txt) speak(txt);
      });
      obs.observe(list, { childList:true, subtree:true });
    }
  }
  return { init, toggleRec, toggleTTS, speak };
})();
document.addEventListener('DOMContentLoaded', () => window.Voice.init());

(function loaderFix(){
  const el = document.getElementById('page-loading');
  if(!el) return;

  // å…ˆç¢ºä¿å¯è¦‹
  el.style.opacity = '1';
  el.style.pointerEvents = 'auto';
  el.classList.remove('hide');

  let done = false;
  function kill(){
    if(done) return; done = true;
    el.classList.add('hide');
    const onEnd = ()=>{ 
      el.removeEventListener('transitionend', onEnd);
      if(el.parentNode) el.parentNode.removeChild(el);
    };
    el.addEventListener('transitionend', onEnd);
    setTimeout(()=>{ if(document.body.contains(el)) el.remove(); }, 800);
  }

  // ç¢ºä¿ DOM å…¨éƒ¨å‡ºç¾å¾Œå†å•Ÿå‹•å€’æ•¸
  window.addEventListener('load', ()=> setTimeout(kill, 1800), { once:true });
  // å¦‚æœ load æ²’è§¸ç™¼ï¼Œä¹Ÿåœ¨ 3 ç§’å¾Œå¼·åˆ¶æ”¶æ‰
  setTimeout(kill, 3000);
})();
// === Loadingï¼šå·²æœ‰å¡ç‰‡ï¼‹è½‰åœˆåœˆï¼›è¼‰å…¥å®Œæˆè‡ªå‹•æ·¡å‡ºï¼ˆä½ çš„ç¾æœ‰ hideLoader å·²æ¶µè“‹ï¼‰ ===
</script>
</body>
</html>