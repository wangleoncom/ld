<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鹿 QA | 系統身分驗證</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- 核心環境設定 --- */
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #000510; /* 極深藍黑 */
            color: white;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        /* --- 背景 Canvas 粒子 --- */
        #canvas-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* --- 主控制台 (玻璃擬態) --- */
        .glass-console {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 420px;
            padding: 40px;
            background: rgba(10, 20, 40, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.1);
            border-radius: 24px;
            box-shadow: 0 0 80px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0, 255, 255, 0.05);
            text-align: center;
            transition: all 0.5s ease;
            overflow: hidden;
        }

        /* 裝飾用的科技邊角 */
        .corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #22d3ee;
            opacity: 0.5;
            transition: all 0.5s;
        }
        .tl { top: 0; left: 0; border-right: none; border-bottom: none; border-radius: 20px 0 0 0; }
        .tr { top: 0; right: 0; border-left: none; border-bottom: none; border-radius: 0 20px 0 0; }
        .bl { bottom: 0; left: 0; border-right: none; border-top: none; border-radius: 0 0 0 20px; }
        .br { bottom: 0; right: 0; border-left: none; border-top: none; border-radius: 0 0 20px 0; }

        /* 激活狀態的邊角發光 */
        .glass-console.active .corner {
            opacity: 1;
            box-shadow: 0 0 15px #22d3ee;
            width: 100%; /* 邊框閉合動畫 */
            height: 100%;
            border-radius: 24px;
        }

        /* --- 區域 1: 鹿頭像 (面部掃描區) --- */
        .avatar-section {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto 20px auto;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.1);
            filter: grayscale(100%) brightness(0.5); /* 初始狀態：灰階暗淡 */
            transition: all 0.5s;
        }

        /* 掃描時的頭像狀態 */
        .scanning-face .avatar-img {
            filter: grayscale(0%) brightness(1); /* 恢復色彩 */
            box-shadow: 0 0 30px rgba(34, 211, 238, 0.3);
            border-color: #22d3ee;
        }

        /* 面部掃描網格 (HUD) */
        .face-hud {
            position: absolute;
            top: -10px; left: -10px; right: -10px; bottom: -10px;
            border: 1px dashed rgba(34, 211, 238, 0.5);
            border-radius: 50%;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s;
        }
        
        /* 掃描光束 */
        .face-scan-beam {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: #22d3ee;
            box-shadow: 0 0 15px #22d3ee;
            opacity: 0;
            z-index: 5;
        }

        .scanning-face .face-hud {
            opacity: 1;
            transform: scale(1);
            animation: spin-slow 10s linear infinite;
        }

        .scanning-face .face-scan-beam {
            opacity: 1;
            animation: scan-vertical 1.5s ease-in-out infinite;
        }

        /* --- 區域 2: 指紋 (互動區) --- */
        .fingerprint-section {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto;
            cursor: pointer;
            transition: all 0.5s;
        }

        .fingerprint-svg {
            fill: rgba(255, 255, 255, 0.2);
            transition: fill 0.3s;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.05));
        }

        .fingerprint-section:active .fingerprint-svg,
        .is-scanning .fingerprint-svg {
            fill: #ec4899; /* 掃描時變粉紅 */
            filter: drop-shadow(0 0 15px rgba(236, 72, 153, 0.8));
        }

        /* 成功後指紋隱藏 */
        .scan-complete .fingerprint-section {
            transform: scale(0);
            height: 0;
            margin: 0;
            opacity: 0;
        }

        /* 指紋外圈進度 */
        .ring-svg {
            position: absolute;
            top: -10px; left: -10px;
            width: 120px; height: 120px;
            transform: rotate(-90deg);
            pointer-events: none;
        }
        .ring-circle {
            fill: none;
            stroke: #ec4899;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-dasharray: 377;
            stroke-dashoffset: 377;
            transition: stroke-dashoffset 0.1s linear;
        }

        /* --- 區域 3: 系統進度條 (最後出現) --- */
        .loader-section {
            height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.5s;
            margin-top: 0;
        }
        
        .loader-visible .loader-section {
            height: auto;
            opacity: 1;
            margin-top: 20px;
        }

        .progress-bar-bg {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #22d3ee, #8b5cf6);
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.6);
            transition: width 0.1s linear;
        }

        /* --- 文字與按鈕 --- */
        h1 {
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
            letter-spacing: 2px;
        }
        
        .status-text {
            font-family: monospace; /* 電腦終端機風格 */
            min-height: 24px;
            color: #94a3b8;
        }

        .blink { animation: blinker 0.5s infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .skip-btn {
            margin-top: 30px;
            color: rgba(255,255,255,0.3);
            font-size: 12px;
            letter-spacing: 1px;
            transition: 0.3s;
        }
        .skip-btn:hover { color: white; }

        /* --- Keyframes --- */
        @keyframes scan-vertical {
            0% { top: 0%; opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        @keyframes spin-slow {
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="glass-console" id="console-panel">
        <div class="corner tl"></div><div class="corner tr"></div>
        <div class="corner bl"></div><div class="corner br"></div>

        <h1 class="text-2xl font-black text-white mb-2">鹿 QA 網站</h1>
        <p class="text-xs text-cyan-400 font-bold tracking-[0.3em] mb-6">安全訪問系統 2.0</p>

        <div class="avatar-section" id="avatar-section">
            <div class="face-hud"></div> <div class="face-scan-beam"></div> <img src="./icon.png" 
                 onerror="this.src='https://ui-avatars.com/api/?name=Deer&background=0D8ABC&color=fff&size=128'" 
                 alt="Deer" 
                 class="avatar-img">
        </div>

        <div id="status-text" class="status-text text-sm mb-6">等待麋鹿指紋驗證...</div>

        <div class="fingerprint-section" id="fingerprint-btn">
            <svg class="ring-svg">
                <circle class="ring-circle" cx="60" cy="60" r="58" id="fp-ring"></circle>
            </svg>
            <svg class="fingerprint-svg w-full h-full" viewBox="0 0 24 24">
                <path d="M17.81,4.43c-2.43-1.89-5.74-2.18-8.23-1.42c-0.5,0.15-0.79,0.68-0.64,1.18c0.15,0.5,0.68,0.79,1.18,0.64
                    c2.06-0.63,4.72-0.4,6.67,1.11c0.42,0.32,1.02,0.25,1.35-0.17C18.46,5.36,18.39,4.75,17.81,4.43z M12,22c-0.55,0-1-0.45-1-1
                    c0-2.45-1.02-3.32-1.92-4.08c-0.84-0.72-1.58-1.35-1.58-2.92c0-2.48,2.02-4.5,4.5-4.5s4.5,2.02,4.5,4.5c0,0.55,0.45,1,1,1
                    s1-0.45,1-1c0-3.58-2.92-6.5-6.5-6.5s-6.5,2.92-6.5,6.5c0,2.38,1.13,3.35,2.15,4.21C8.03,18.61,8.5,19.01,8.5,20
                    c0,0.55-0.45,1-1,1s-1-0.45-1-1c0-2.02-1.02-2.89-1.92-3.65C3.74,15.65,3,15.02,3,13.5c0-4.96,4.04-9,9-9s9,4.04,9,9
                    c0,0.55,0.45,1,1,1s1-0.45,1-1C23,8.04,18.06,3.5,12,3.5S1,8.04,1,13.5c0,2.48,1.13,3.45,2.15,4.31C4.03,18.71,4.5,19.11,4.5,20.1
                    c0,1.3,0.84,2.4,2,2.82c0.3,0.11,0.6,0.16,0.9,0.16c0.82,0,1.59-0.36,2.1-0.98c0.34-0.42,0.28-1.04-0.14-1.38
                    c-0.42-0.34-1.04-0.28-1.38,0.14C7.81,21.08,7.6,21.13,7.45,21.07c-0.26-0.09-0.45-0.34-0.45-0.63c0-0.51-0.24-0.72-0.49-0.93
                    c-0.01-0.01-0.02-0.02-0.03-0.03C5.62,18.74,5,18.21,5,16.5c0-0.55,0.45-1,1-1s1,0.45,1,1c0,0.66,0.24,0.87,0.49,1.08
                    c0.01,0.01,0.02,0.02,0.03,0.03c0.86,0.73,1.48,1.26,1.48,2.39c0,0.55,0.45,1,1,1s1-0.45,1-1c0-0.51-0.24-0.72-0.49-0.93
                    c-0.01-0.01-0.02-0.02-0.03-0.03C9.62,18.24,9,17.71,9,16c0-0.55,0.45-1,1-1s1,0.45,1,1c0,0.66,0.24,0.87,0.49,1.08
                    c0.01,0.01,0.02,0.02,0.03,0.03c0.86,0.73,1.48,1.26,1.48,2.39c0,0.55,0.45,1,1,1s1-0.45,1-1c0-1.65-2.02-3-4.5-3
                    s-4.5,1.35-4.5,3c0,0.55,0.45,1,1,1s1-0.45,1-1c0-0.55,1.12-1,2.5-1s2.5,0.45,2.5,1c0,0.55,0.45,1,1,1S13,22.55,13,22
                    C13,22,12.55,22,12,22z"/>
            </svg>
        </div>

        <div class="loader-section" id="loader-section">
            <div class="flex justify-between text-xs text-cyan-300 mb-1">
                <span>SYSTEM LOADING</span>
                <span id="load-percent">0%</span>
            </div>
            <div class="progress-bar-bg">
                <div class="progress-bar-fill" id="final-progress"></div>
            </div>
        </div>

        <button onclick="redirectNow()" class="skip-btn">[ 跳過動畫直接進入 ]</button>
    </div>

    <script>
        const NEW_URL = "https://wangleoncom.github.io/ldweb";

        // DOM 元素
        const consolePanel = document.getElementById('console-panel');
        const fpBtn = document.getElementById('fingerprint-btn');
        const fpRing = document.getElementById('fp-ring');
        const statusText = document.getElementById('status-text');
        const avatarSection = document.getElementById('avatar-section');
        const loaderSection = document.getElementById('loader-section'); // 修正 ID
        const finalProgress = document.getElementById('final-progress');
        const loadPercent = document.getElementById('load-percent');

        // 狀態變數
        let isHolding = false;
        let fpProgress = 0;
        let animationFrame;
        let systemState = 0; // 0:指紋, 1:面部, 2:載入

        // 初始化指紋圈圈
        const ringCircumference = 377;
        fpRing.style.strokeDasharray = `${ringCircumference} ${ringCircumference}`;
        fpRing.style.strokeDashoffset = ringCircumference;

        // --- 階段 1: 指紋驗證邏輯 ---
        function startFpScan(e) {
            if (systemState !== 0) return;
            e.preventDefault();
            isHolding = true;
            fpBtn.classList.add('is-scanning');
            statusText.innerText = "正在讀取生物特徵...";
            statusText.style.color = "#ec4899"; // 粉紅
            
            if (navigator.vibrate) navigator.vibrate(50);
            tickFp();
        }

        function stopFpScan() {
            if (systemState !== 0) return;
            isHolding = false;
            cancelAnimationFrame(animationFrame);
            fpBtn.classList.remove('is-scanning');

            if (fpProgress < 100) {
                // 失敗回退
                statusText.innerText = "驗證中斷，請重新按壓";
                statusText.style.color = "#ef4444";
                
                let retreat = setInterval(() => {
                    fpProgress -= 5;
                    if (fpProgress <= 0) {
                        fpProgress = 0;
                        statusText.innerText = "等待麋鹿指紋驗證...";
                        statusText.style.color = "#94a3b8";
                        clearInterval(retreat);
                    }
                    updateFpRing(fpProgress);
                }, 10);
            }
        }

        function tickFp() {
            if (!isHolding) return;
            fpProgress += 2; // 指紋速度
            updateFpRing(fpProgress);

            if (fpProgress >= 100) {
                systemState = 1;
                finishFpStage();
            } else {
                animationFrame = requestAnimationFrame(tickFp);
            }
        }

        function updateFpRing(percent) {
            const offset = ringCircumference - (percent / 100) * ringCircumference;
            fpRing.style.strokeDashoffset = offset;
        }

        function finishFpStage() {
            // 指紋成功
            if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
            statusText.innerText = "指紋確認：符合麋鹿特徵";
            statusText.style.color = "#10b981"; // 綠色
            
            // UI 變換：隱藏指紋，進入面部掃描
            consolePanel.classList.add('scan-complete'); // 隱藏指紋按鈕
            
            setTimeout(() => {
                startFaceScanStage();
            }, 800);
        }

        // --- 階段 2: 面部掃描邏輯 ---
        function startFaceScanStage() {
            statusText.innerText = "啟動鹿臉部識別掃描...";
            statusText.style.color = "#22d3ee"; // 青色
            
            // 激活頭像動畫
            avatarSection.classList.add('scanning-face');
            
            // 播放掃描音效感 (視覺)
            consolePanel.classList.add('active'); // 邊框發光

            // 模擬分析過程 (2秒)
            let textSteps = ["正在分析鹿角結構...", "比對資料庫...", "確認身分：麋鹿"];
            let step = 0;
            
            let scanInterval = setInterval(() => {
                if (step < textSteps.length) {
                    statusText.innerText = textSteps[step];
                    statusText.classList.add('blink'); // 文字閃爍
                    setTimeout(() => statusText.classList.remove('blink'), 200);
                    step++;
                } else {
                    clearInterval(scanInterval);
                    finishFaceScanStage();
                }
            }, 800);
        }

        function finishFaceScanStage() {
            statusText.innerText = "身分驗證完全通過！";
            statusText.style.color = "#10b981";
            if (navigator.vibrate) navigator.vibrate(100);
            
            setTimeout(() => {
                startFinalLoadingStage();
            }, 500);
        }

        // --- 階段 3: 最終進度條邏輯 ---
        function startFinalLoadingStage() {
            systemState = 2;
            document.body.classList.add('loader-visible'); // CSS Class helper
            loaderSection.parentElement.classList.add('loader-visible'); // 讓 loader 顯示

            statusText.innerText = "正在初始化新版系統...";
            statusText.style.color = "white";

            let loadP = 0;
            let loadTimer = setInterval(() => {
                loadP += Math.random() * 5; // 隨機速度
                if (loadP > 100) loadP = 100;
                
                finalProgress.style.width = loadP + "%";
                loadPercent.innerText = Math.floor(loadP) + "%";

                if (loadP === 100) {
                    clearInterval(loadTimer);
                    statusText.innerText = "準備傳送...";
                    setTimeout(redirectNow, 500);
                }
            }, 100);
        }

        // --- 最終跳轉 ---
        function redirectNow() {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 1s ease';
            setTimeout(() => {
                window.location.replace(NEW_URL);
            }, 1000);
        }

        // 綁定事件
        fpBtn.addEventListener('mousedown', startFpScan);
        fpBtn.addEventListener('touchstart', startFpScan);
        window.addEventListener('mouseup', stopFpScan);
        window.addEventListener('touchend', stopFpScan);

        // --- 背景粒子特效 ---
        const canvas = document.getElementById('canvas-bg');
        const ctx = canvas.getContext('2d');
        let particles = [];
        
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2;
                this.speedX = Math.random() * 0.5 - 0.25;
                this.speedY = Math.random() * 0.5 - 0.25;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x > canvas.width) this.x = 0; else if (this.x < 0) this.x = canvas.width;
                if (this.y > canvas.height) this.y = 0; else if (this.y < 0) this.y = canvas.height;
            }
            draw() {
                ctx.fillStyle = 'rgba(34, 211, 238, 0.3)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() { for (let i = 0; i < 80; i++) particles.push(new Particle()); }
        initParticles();
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // 防回頭
        window.history.pushState(null, "", window.location.href);
        window.onpopstate = () => {
            window.history.pushState(null, "", window.location.href);
            redirectNow();
        };
    </script>
</body>
</html>
