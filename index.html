<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é¹¿ğŸ¦Œçš„QAç¶²ç«™</title>
  <meta name="theme-color" content="#0f1220" />
  <link rel="icon" type="image/png" href="ç¶²ç«™é ‚ç«¯icon.JPG">
  <link rel="stylesheet" href="styles.css?v=20251008" />
  <style>
    /* åŸºæœ¬è¦†è“‹ï¼šèˆ‡å¤–éƒ¨ styles.css å…±å­˜ */
    .page-overlay{position:fixed;inset:0;z-index:9999;display:grid;place-items:center;background:rgba(7,11,22,.78);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);opacity:1;transition:opacity .35s ease;pointer-events:auto}
    .page-overlay.hide{opacity:0;pointer-events:none}
    .page-overlay .card{width:min(360px,86vw);background:linear-gradient(180deg,rgba(22,26,48,.72) 0%, rgba(28,33,62,.72) 100%);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:20px;text-align:center;color:#f6f8ff;box-shadow:0 24px 60px rgba(0,0,0,.45),0 8px 24px rgba(0,0,0,.30)}
    .page-overlay .spinner{display:grid;place-items:center;margin:12px auto 8px}
    .loading-img{width:84px;height:84px;border-radius:50%;display:block;object-fit:cover}
    #page-loading{position:fixed;inset:0;z-index:9999;display:grid;place-items:center;background:rgba(7,11,22,.78);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);opacity:1;transition:opacity .35s ease}
    #page-loading.hide{opacity:0;pointer-events:none}
    #page-loading .card{width:min(360px,86vw);background:linear-gradient(180deg,rgba(22,26,48,.72) 0%, rgba(28,33,62,.72) 100%);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:20px;text-align:center;color:#f6f8ff;box-shadow:0 24px 60px rgba(0,0,0,.45),0 8px 24px rgba(0,0,0,.30)}
    #page-loading .spinner{display:grid;place-items:center;margin:12px auto 8px}
    #page-loading .loading-img{width:84px;height:84px;border-radius:50%;display:block;object-fit:cover}
    .mini-overlay{position:absolute;inset:0;display:grid;place-items:center;z-index:4;background:rgba(7,11,22,.68);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
    .video-embed{position:relative}
    .toast{position:fixed;z-index:10000;padding:8px 12px;border-radius:10px;background:rgba(15,18,32,.9);color:#fff;font-weight:700;font-size:.9rem;box-shadow:0 10px 30px rgba(0,0,0,.35);transform:translate(-50%,0);animation:toast-in .18s ease-out,toast-out .28s ease-in 1.5s forwards}
    @keyframes toast-in{from{opacity:0;transform:translate(-50%,-6px)}to{opacity:1;transform:translate(-50%,0)}}
    @keyframes toast-out{to{opacity:0;transform:translate(-50%,-6px)}}
    .tool{cursor:pointer;user-select:none}
    .tool.copied{transform:scale(1.06);transition:transform .18s ease}
    #site-share{white-space:nowrap;padding-left:12px;padding-right:12px}

    /* åè¤‡è£½/é•·æŒ‰ï¼ˆå…¨ç«™ï¼‰â€” QA å€ç™½åå–® */
    html,body{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none}
    img{-webkit-user-drag:none;pointer-events:none}
    #logo-img{pointer-events:auto}
    #qa-list,#qa-list *{-webkit-user-select:text;user-select:text;-webkit-touch-callout:default}
    @media print{body{display:none !important}}

    /* æ‰‹æ©Ÿå½±ç‰‡æŠ½å±œï¼ˆé…åˆ body.vlist-openï¼‰ */
    @media (max-width: 768px){
      body.vlist-open #v-list{transform:translateY(0)!important}
    }
  </style>
</head>
<body>
  <div id="page-loading" aria-live="polite" aria-busy="true">
    <div class="card">
      <div class="spinner"><img src="è½‰åœˆåœˆ.png" alt="è¼‰å…¥ä¸­" class="loading-img"></div>
      <div class="title">ç¶²é è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™â€¦</div>
      <div class="muted" style="font-size:.9rem">æ­£åœ¨æº–å‚™è³‡æ–™èˆ‡ä»‹é¢</div>
    </div>
  </div>

  <div id="changelog" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="cg-title">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="cg-title">ğŸ¦Œ ç¶²ç«™æ›´æ–°</h2>
        <button id="cg-close" class="btn ghost">æˆ‘çŸ¥é“äº†ï¼Œé—œé–‰è¦–çª—âŒ</button>
      </div>
      <div class="modal-body" id="cg-body"></div>
    </div>
  </div>

  <div id="ann-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="ann-title">
    <div class="modal-card">
      <div class="modal-header">
        <h2 id="ann-title">ç¶²ç«™å…¬å‘Š</h2>
        <button id="ann-close" class="btn ghost">âŒé—œé–‰å…¬å‘Š</button>
      </div>
      <div class="modal-body" id="ann-body"></div>
    </div>
  </div>

  <header class="hero">
    <div class="brand">
      <img id="logo-img" src="Logo.png" class="logo-img" alt="é¹¿ Logo" />
      <div>
        <h1>é¹¿ğŸ¦Œçš„QAç¶²ç«™</h1>
        <p class="muted">æŸ¥è©¢è³‡æ–™åº«èˆ‡è§€çœ‹å½±ç‰‡ã€‚è‹¥æœ‰éŒ¯èª¤ï¼Œè«‹å›å ±å·¥ç¨‹å¸«ã€‚</p>
      </div>
    </div>

    <div class="top-actions">
      <button id="site-bell" class="btn ghost icon" title="å…¬å‘Š" aria-label="å…¬å‘Š">ğŸ”” <span class="muted" style="font-size:.9rem">å…¬å‘Š</span></button>
      <button id="site-share" class="btn icon share-top" title="åˆ†äº«ç¶²ç«™" aria-label="åˆ†äº«ç¶²ç«™">åˆ†äº«</button>
      <a id="contact-eng" class="btn ghost icon" href="mailto:wanglien214@gmail.com" title="è¯çµ¡å·¥ç¨‹å¸«" aria-label="è¯çµ¡å·¥ç¨‹å¸«">ğŸ“§ <span class="muted" style="font-size:.9rem">è¯çµ¡å·¥ç¨‹å¸«</span></a>
    </div>

    <nav class="tabs" role="tablist" aria-label="ä¸»è¦åŠŸèƒ½">
      <button id="tab-qa" class="tab active" role="tab" aria-selected="true" aria-controls="qa-panel">QA</button>
      <button id="tab-video" class="tab" role="tab" aria-selected="false" aria-controls="video-panel">å½±ç‰‡</button>
    </nav>

    <div id="qa-toolbar" class="search-wrap">
      <input id="search" class="input" type="search" placeholder="è¼¸å…¥é—œéµå­—ï¼ˆå‚³çµ±æ¯”å°ï¼‰" aria-label="æœå°‹ QA" />
      <button id="clear" class="btn ghost">æ¸…é™¤</button>
    </div>

    <div class="stats" id="qa-stats">
      <div class="stat"><span id="stat-total" class="value">0</span><span class="label">ç¸½ç­†æ•¸</span></div>
      <div class="stat"><span id="stat-page" class="value">1</span><span class="label">ç›®å‰é </span></div>
      <div class="stat"><span id="stat-pages" class="value">1</span><span class="label">ç¸½é æ•¸</span></div>
      <div class="stat"><span id="stat-filtered" class="value">0</span><span class="label">ç›®å‰ç¯©é¸</span></div>
    </div>
  </header>

  <main class="container">
    <section id="qa-panel" class="tabpanel" role="tabpanel" aria-labelledby="tab-qa">
      <section id="qa-list" class="accordion"></section>
      <nav class="pager" aria-label="åˆ†é å°è¦½">
        <button id="prev" class="btn">ä¸Šä¸€é </button>
        <input id="page" class="page-input" type="text" inputmode="numeric" pattern="[0-9]*" value="1" aria-label="è·³è‡³é ç¢¼">
        <span class="slash">/</span>
        <span id="pages" class="pages-badge">1</span>
        <button id="next" class="btn">ä¸‹ä¸€é </button>
      </nav>
      <footer class="footer" aria-hidden="true" style="visibility:hidden;height:0;padding:0;margin:0"></footer>
    </section>

    <section id="video-panel" class="tabpanel hidden" role="tabpanel" aria-labelledby="tab-video">
      <div class="video-layout">
        <div class="video-left">
          <div class="video-controls top">
            <button id="v-random" class="btn">éš¨æ©Ÿå½±ç‰‡</button>
            <!-- ç›®éŒ„æŒ‰éˆ•æœƒç”± JS æ³¨å…¥åˆ°é€™è£¡ -->
          </div>
          <div class="video-header">
            <span id="v-title" class="video-title">æœªé¸æ“‡å½±ç‰‡</span>
            <button id="v-info-btn" class="info-btn" title="å½±ç‰‡è³‡è¨Š">â„¹ï¸</button>
          </div>
          <div id="v-frame" class="video-frame"></div>
        </div>
        <div class="video-right" id="v-list"></div>
      </div>
    </section>
  </main>

  <div id="info-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card small">
      <div class="modal-header">
        <h3>å½±ç‰‡è³‡è¨Š</h3>
        <button id="modal-close" class="btn ghost">âŒé—œé–‰å½±ç‰‡è³‡è¨Š</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <button id="ai-fab" class="ai-fab" aria-label="é–‹å•Ÿ AI éº‹é¹¿">
    <svg width="26" height="26" viewBox="0 0 24 24"><path fill="currentColor" d="M4 4h16v10H7l-3 3V4z"/><circle cx="9" cy="9" r="1.5" fill="#0f1220"/><circle cx="14" cy="9" r="1.5" fill="#0f1220"/></svg>
  </button>

  <aside id="ai-panel" class="ai-panel hidden" role="dialog" aria-modal="true" aria-labelledby="ai-title">
    <header class="ai-header"><h2 id="ai-title">AIéº‹é¹¿</h2><button id="ai-close" class="btn ghost" aria-label="é—œé–‰">âŒé—œé–‰èŠå¤©å®¤</button></header>
    <div id="ai-messages" class="ai-messages"></div>
    <form id="ai-form" class="ai-input" autocomplete="off">
      <input id="ai-text" class="input ai-inputbox" placeholder="è¼¸å…¥ä¸¦æŒ‰ Enter é€å‡º" aria-label="AIè¼¸å…¥">
      <div style="display:flex;gap:8px">
        <button id="ai-mic" class="btn ghost" type="button" title="èªéŸ³è¼¸å…¥">ğŸ™ï¸</button>
        <button id="ai-tts" class="btn ghost" type="button" title="èªéŸ³æœ—è®€">ğŸ”Š</button>
        <button class="btn primary" type="submit">é€å‡º</button>
      </div>
    </form>
  </aside>

  <script src="deer-qa.js"></script>
  <script src="app.js"></script>
  <script src="qa-accordion-fix.js"></script>
  <script src="deer-video-min.js"></script>

  <script>
/* ============ åŸºæœ¬å·¥å…·/Loader ============ */
const LOADER_IMG={global:'è½‰åœˆåœˆ.png',page:'è½‰åœˆåœˆ.png','tab-qa':'è½‰åœˆåœˆ.png','tab-video':'è½‰åœˆåœˆ.png',video:'è½‰åœˆåœˆ.png','ai-open':'è½‰åœˆåœˆ2.png','ai-close':'è½‰åœˆåœˆ2.png'};
window.escapeHTML||=(s)=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
window.scrollBottom||=()=>{const m=document.getElementById('ai-messages'); if(m) m.scrollTop=m.scrollHeight;};

(function bootLoader(){
  const root=document.getElementById('page-loading'); if(!root) return;
  const img=root.querySelector('.loading-img'); if(img) img.src=LOADER_IMG.global||img.src;
  document.body.style.overflow='hidden';
  const start=Date.now(),MIN=2200;
  function kill(){const wait=Math.max(0,MIN-(Date.now()-start));
    setTimeout(()=>{root.classList.add('hide');root.addEventListener('transitionend',()=>{root.remove();document.body.style.overflow='';},{once:true});},wait);}
  window.addEventListener('load',kill,{once:true}); setTimeout(kill,6000);
})();
const Loading=(()=>{const MIN=2200,map=new Map();
  function lock(on){document.body.style.overflow=on?'hidden':'';}
  function ensure(id,text='è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™â€¦',key='global'){let el=document.getElementById(id);const src=LOADER_IMG[key]||LOADER_IMG.global||'è½‰åœˆåœˆ.png';
    if(!el){el=document.createElement('div');el.id=id;el.className='page-overlay';el.setAttribute('aria-live','polite');el.setAttribute('aria-busy','true');
      el.innerHTML=`<div class="card"><div class="spinner"><img src="${src}" alt="" class="loading-img"></div><div class="title">${text}</div><div class="muted" style="font-size:.9rem">æ­£åœ¨æº–å‚™è³‡æ–™èˆ‡ä»‹é¢</div></div>`;
      document.body.appendChild(el);} else {el.querySelector('.loading-img').src=src; const ttl=el.querySelector('.title'); if(ttl) ttl.textContent=text;}
    return el;}
  function show(key='global',text){const id=`ov-${key}`;const el=ensure(id,text||'è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™â€¦',key); el.classList.remove('hide'); map.set(id,Date.now()); lock(true); return id;}
  function hide(key='global'){const id=`ov-${key}`;const el=document.getElementById(id); if(!el) return; const st=map.get(id)||Date.now(); const wait=Math.max(0,MIN-(Date.now()-st));
    setTimeout(()=>{el.classList.add('hide');el.addEventListener('transitionend',()=>{el.remove(); if(!document.querySelector('.page-overlay')&&!document.getElementById('page-loading')) lock(false);},{once:true}); map.delete(id);},wait);}
  function videoShow(){const host=document.getElementById('v-frame'); if(!host) return Date.now(); let m=host.querySelector('.mini-overlay'); const src=LOADER_IMG.video||LOADER_IMG.global||'è½‰åœˆåœˆ.png';
    if(!m){m=document.createElement('div');m.className='mini-overlay';m.innerHTML=`<div class="spinner"><img src="${src}" alt="" class="loading-img"></div>`; host.appendChild(m);} else {m.querySelector('.loading-img').src=src;}
    return Date.now();}
  function videoHide(mark){const host=document.getElementById('v-frame'); if(!host) return; const m=host.querySelector('.mini-overlay'); if(!m) return; const left=Math.max(0,1200-(Date.now()-(mark||Date.now()))); setTimeout(()=>m.remove(),left);}
  return {show,hide,videoShow,videoHide};
})();

/* ============ å…¬å‘Šç°¡æ˜“å½ˆå±¤ ============ */
const Ann=(()=>{function open({title='è¨Šæ¯',html=''}){close();const el=document.createElement('div');el.id='overlay-modal';el.innerHTML=`<div class="modal-card"><div class="modal-header"><h2 style="margin:0;font-size:1.05rem">${title}</h2><button id="ov-close" class="btn ghost">é—œé–‰</button></div><div class="modal-body">${html||'<p class="muted">ç›®å‰æ²’æœ‰å…¬å‘Šã€‚</p>'}</div></div>`; document.body.appendChild(el); document.body.style.overflow='hidden'; el.addEventListener('click',e=>{if(e.target===el) close();}); el.querySelector('#ov-close')?.addEventListener('click',close);}
  function close(){const el=document.getElementById('overlay-modal'); if(el){el.remove(); document.body.style.overflow='';}}
  return {open,close};
})();
const ANNOUNCEMENTS=[{id:'welcome-410',title:'V4.1 ä¸Šç·š',body:'æ”¯æ´èªéŸ³è¼¸å…¥èˆ‡æœ—è®€ã€‚',start:'2025-10-07'}];
(function(){const bell=document.getElementById('site-bell'); if(!bell) return; bell.addEventListener('click',()=>{const now=Date.now(); const active=ANNOUNCEMENTS.filter(a=>{const st=a.start?new Date(a.start).getTime():-Infinity; const ed=a.end?new Date(a.end).getTime():Infinity; return now>=st&&now<=ed;});
  const html=active.length?`<div class="ann-list">${active.map(a=>`<article class="ann-item" style="margin:10px 0"><h4 style="margin:.2rem 0">${a.title}</h4><div class="muted" style="font-size:.9rem">${(a.start||'').slice(0,10)}${a.end?` â€” ${a.end.slice(0,10)}`:''}</div><p style="margin:.4rem 0 0">${a.body}</p></article>`).join('')}</div>`:`<p class="muted">ç›®å‰æ²’æœ‰å…¬å‘Šã€‚</p>`; Ann.open({title:'ç¶²ç«™å…¬å‘Š',html});});})();

/* ============ QA è¤‡è£½ï¼ˆæŒ‰éˆ•ç™½åå–®ï¼‰ ============ */
(function setupQACopy(){
  const list=document.getElementById('qa-list'); if(!list) return;
  function ensureCopyButtons(root=list){
    root.querySelectorAll('.item').forEach(item=>{
      if(item.querySelector('.tool.copy-qa')) return;
      const header=item.querySelector('.q'); if(!header) return;
      const tools=header.querySelector('.tools')||(()=>{const t=document.createElement('div');t.className='tools';t.style.marginLeft='auto';t.style.display='flex';t.style.gap='8px';header.appendChild(t);return t;})();
      const btn=document.createElement('span'); btn.className='tool copy-qa'; btn.setAttribute('role','button'); btn.setAttribute('tabindex','0'); btn.title='è¤‡è£½é€™å‰‡ QA'; btn.textContent='ğŸ“‹ è¤‡è£½';
      tools.appendChild(btn);
    });
  }
  function toastAt(text,rect){const tip=document.createElement('div'); tip.className='toast'; tip.textContent=text; const y=Math.max(12,window.scrollY+rect.top-14); const x=Math.min(window.innerWidth-12,Math.max(12,window.scrollX+rect.left+rect.width/2)); tip.style.top=`${y}px`; tip.style.left=`${x}px`; tip.style.transform='translate(-50%,0)'; document.body.appendChild(tip); setTimeout(()=>tip.remove(),1650);}
  async function doCopy(fromEl,btn){const item=fromEl.closest('.item'); const txt=item?.querySelector('.a-inner')?.innerText?.trim(); if(!txt) return; await navigator.clipboard.writeText(txt); btn.classList.add('copied'); setTimeout(()=>btn.classList.remove('copied'),420); toastAt('å·²è¤‡è£½ QA', btn.getBoundingClientRect());}
  document.addEventListener('click',e=>{const btn=e.target.closest('.tool.copy-qa,[data-copy]'); if(!btn) return; e.preventDefault(); doCopy(btn,btn);},true);
  document.addEventListener('keydown',e=>{if((e.key==='Enter'||e.key===' ')&&e.target.closest('.tool.copy-qa')){e.preventDefault(); doCopy(e.target,e.target);}},true);
  ensureCopyButtons(); new MutationObserver(m=>m.forEach(x=>x.addedNodes.forEach(n=>{if(n.nodeType===1) ensureCopyButtons(n);}))).observe(list,{childList:true,subtree:true});
})();

/* ============ å½±ç‰‡ï¼šé»ä¸€æ¬¡æ¸²æŸ“ + å°é®ç½© ============ */
(function videoClickOnce(){
  const list=document.getElementById('v-list'), frame=document.getElementById('v-frame'), title=document.getElementById('v-title'); if(!list||!frame) return;
  let lock=false,lastKey='';
  list.addEventListener('click',e=>{
    const item=e.target.closest('[data-video]'); if(!item) return;
    if(lock) return; lock=true; setTimeout(()=>lock=false,600);
    try{
      const data=JSON.parse(item.dataset.video||'{}'); const key=(data.id||data.url||'')+'|'+(data.title||''); if(key===lastKey) return; lastKey=key;
      frame.innerHTML='';
      const wrap=document.createElement('div');
      wrap.className='video-embed';
      wrap.innerHTML=`<iframe src="${data.url||''}" allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>`;
      frame.appendChild(wrap);
      if(title) title.textContent=data.title||'å½±ç‰‡';
      const mark=Loading.videoShow();
      const timer=setInterval(()=>{const ifr=frame.querySelector('iframe'); if(ifr){clearInterval(timer); ifr.addEventListener('load',()=>Loading.videoHide(mark),{once:true}); setTimeout(()=>Loading.videoHide(mark),5000);}},60);
      setTimeout(()=>clearInterval(timer),2000);
    }catch{}
  },true);
})();

/* ============ QA åˆ†é é®ç½© + æ²é ‚ ============ */
(function qaPagingOverlay(){
  const ids=['prev','next','page'], list=document.getElementById('qa-list'); if(!list) return;
  function armHide(){const mo=new MutationObserver(()=>{clearTimeout(armHide.t); armHide.t=setTimeout(()=>Loading.hide('page'),240);}); mo.observe(list,{childList:true,subtree:true}); setTimeout(()=>{mo.disconnect(); Loading.hide('page');},8000);}
  ids.forEach(id=>{const el=document.getElementById(id); if(!el) return; const evt=(id==='page')?'change':'click'; el.addEventListener(evt,()=>{Loading.show('page','åˆ‡æ›é é¢ä¸­ï¼Œè«‹ç¨å€™â€¦'); armHide(); window.scrollTo({top:0,behavior:'smooth'});});});
})();

/* ============ AI é¢æ¿é®ç½© ============ */
(function aiPanelOverlay(){
  const fab=document.getElementById('ai-fab'), close=document.getElementById('ai-close'), panel=document.getElementById('ai-panel');
  function waitUntil(testFn,key){const st=Date.now(); const it=setInterval(()=>{if(testFn()){clearInterval(it); Loading.hide(key);} else if(Date.now()-st>5000){clearInterval(it); Loading.hide(key);}},60);}
  fab?.addEventListener('click',()=>{Loading.show('ai-open','é–‹å•Ÿ AI ä¸­ï¼Œè«‹ç¨å€™â€¦'); waitUntil(()=>!panel.classList.contains('hidden')||panel.classList.contains('show'),'ai-open');});
  close?.addEventListener('click',()=>{Loading.show('ai-close','é—œé–‰ AI ä¸­â€¦'); waitUntil(()=>panel.classList.contains('hidden')&&!panel.classList.contains('show'),'ai-close');});
})();

/* ============ ç¦ä¸€èˆ¬è¤‡è£½/å³éµ/æˆªåœ–ï¼ˆQA ç™½åå–®ï¼‰ ============ */
(function antiCopy(){
  document.addEventListener('contextmenu', e=>e.preventDefault(), true);
  document.addEventListener('copy', e=>e.preventDefault(), true);
  document.addEventListener('cut',  e=>e.preventDefault(), true);
  document.addEventListener('dragstart', e=>e.preventDefault(), true);
  document.getElementById('logo-img')?.setAttribute('draggable','false');

  document.addEventListener('keydown', async e=>{
    const k=(e.key||'').toLowerCase();
    if ((e.ctrlKey && (k==='c'||k==='x'||k==='s'||k==='u')) ||
        (e.metaKey && (k==='c'||k==='x'||k==='s'||k==='u')) ||
        (e.ctrlKey && e.shiftKey && ['i','j','c'].includes(k)) ||
        k==='f12'){
      e.preventDefault();
    }
    if (k==='printscreen' || k==='snapshot'){
      e.preventDefault();
      try{ await navigator.clipboard.writeText(''); }catch{}
    }
  }, true);
})();


/* ============ å·¥ç¨‹æ¨¡å¼ï¼šåœè½‰åœˆ/å±•é–‹ QA/æ‰‹æ©Ÿå½±ç‰‡æŠ½å±œ ============ */
const LoaderKillSwitch={armed:false,arm(){this.armed=true;},apply(){if(!this.armed) return; try{const tag=document.createElement('style'); tag.textContent='.spinner .loading-img{animation:none!important}'; document.head.appendChild(tag);
  document.querySelectorAll('#page-loading,.page-overlay,.mini-overlay').forEach(n=>n.remove()); document.body.style.overflow='';
  if(window.Loading){ if(Loading.show) Loading.show=function(){return null}; if(Loading.videoShow) Loading.videoShow=function(){return Date.now()}; }
}catch{}}};
function unfurlAllQA(){document.querySelectorAll('#qa-list .item').forEach(it=>{it.classList.add('open'); const a=it.querySelector('.a'); if(a) a.style.height='auto';});}
const MobileVideoDrawer={inited:false,init(){if(this.inited) return; this.inited=true; const mq=window.matchMedia('(max-width:768px)'); const list=document.getElementById('v-list'); const header=document.querySelector('.video-controls.top'); if(!list||!header) return;
  const setup=()=>{if(!mq.matches){document.body.classList.remove('vlist-open'); return;} if(!document.getElementById('v-toggle')){const btn=document.createElement('button'); btn.id='v-toggle'; btn.className='btn'; btn.textContent='ç›®éŒ„'; header.appendChild(btn);
    btn.addEventListener('click',()=>{const key='vlist'; if(window.Loading?.show){Loading.show(key,'è¼‰å…¥æ¸…å–®ä¸­ï¼Œè«‹ç¨å€™â€¦'); const dur=300+Math.floor(Math.random()*250); setTimeout(()=>{document.body.classList.add('vlist-open'); Loading.hide(key);},dur);} else {document.body.classList.add('vlist-open');}});}};
  setup(); mq.addEventListener?.('change',setup); list.addEventListener('click',e=>{if(e.target.closest('[data-video]')) document.body.classList.remove('vlist-open');});}};

/* ============ éš±è—å¼ PIN é©—è­‰ï¼ˆåªæ¯”å°é›œæ¹Šï¼‰ ============ */
function hashPin(s){let h=0x811c9dc5>>>0; for(let i=0;i<s.length;i++){h^=s.charCodeAt(i); h=Math.imul(h,0x01000193);} return ('0000000'+(h>>>0).toString(16)).slice(-8);}
const PIN_ROUTES_HASHED = Object.freeze({
  /* å°æ‡‰æ˜ç¢¼ï¼ˆä¾›ä½ ä¿å­˜ï¼‰ï¼šd33r-ALL-7925 / d33r-ENG-2048 / d33r-RESET-9090 */
  "f48f0be3": Object.freeze(["ENG_ON","NOSPIN","UNFURL","VID_MOBILE"]), // å…¨é–‹
  "44403c49": Object.freeze(["ENG_ON","UNFURL"]),                        // å·¥ç¨‹+å±•é–‹QA
  "3950f0a2": Object.freeze(["RESET"])                                   // é‡ç½®
});
function runEngineerActions(acts){
  const FLAG='deerENG';
  acts.forEach(a=>{
    if(a==="ENG_ON"){sessionStorage.setItem(FLAG,'1');}
    else if(a==="NOSPIN"){LoaderKillSwitch.arm(); LoaderKillSwitch.apply();}
    else if(a==="UNFURL"){unfurlAllQA();}
    else if(a==="VID_MOBILE"){MobileVideoDrawer.init();}
    else if(a==="RESET"){sessionStorage.removeItem(FLAG); location.reload();}
  });
  if(acts.includes("ENG_ON") && !acts.includes("RESET")) location.reload();
}
(function engineerGate(){
  const logo=document.getElementById('logo-img'); if(logo) logo.setAttribute('draggable','false');
  let taps=0,t=null;
  function ask(){const input=prompt('è«‹è¼¸å…¥å·¥ç¨‹ç¢¼'); if(!input){alert('å·¥ç¨‹ç¢¼ä¸æ­£ç¢º'); return;}
    const h=hashPin(input); const acts=PIN_ROUTES_HASHED[h]; if(!acts){alert('å·¥ç¨‹ç¢¼ä¸æ­£ç¢º'); return;} runEngineerActions(acts);}
  logo?.addEventListener('click',()=>{taps++; clearTimeout(t); t=setTimeout(()=>taps=0,1000); if(taps>=10){taps=0; ask();}});
  if(sessionStorage.getItem('deerENG')==='1'){LoaderKillSwitch.arm(); LoaderKillSwitch.apply(); unfurlAllQA(); MobileVideoDrawer.init();}
})();

/* ============ Tabs é®ç½©/åˆ†äº« ============ */
(function tabsOverlay(){
  const tabVideo=document.getElementById('tab-video'), tabQA=document.getElementById('tab-qa');
  const videoPanel=document.getElementById('video-panel'), qaPanel=document.getElementById('qa-panel');
  function waitPanelReady(panel,selector,key){const mo=new MutationObserver(()=>{if(panel.querySelector(selector)){mo.disconnect(); Loading.hide(key);}}); mo.observe(panel,{childList:true,subtree:true}); setTimeout(()=>{mo.disconnect(); Loading.hide(key);},5000);}
  tabVideo?.addEventListener('click',()=>{Loading.show('tab-video','è¼‰å…¥å½±ç‰‡é é¢ä¸­ï¼Œè«‹ç¨å€™â€¦'); setTimeout(()=>waitPanelReady(videoPanel,'#v-list *, iframe','tab-video'),0);});
  tabQA?.addEventListener('click',()=>{Loading.show('tab-qa','è¼‰å…¥ QA é é¢ä¸­ï¼Œè«‹ç¨å€™â€¦'); setTimeout(()=>waitPanelReady(qaPanel,'.item','tab-qa'),0);});
})();
(function shareFix(){
  const btn=document.getElementById('site-share'); if(!btn) return;
  btn.addEventListener('click',async()=>{
    const data={title:document.title,text:'é¹¿ğŸ¦Œçš„QAç¶²ç«™',url:location.href};
    try{
      if(navigator.share){await navigator.share(data);}
      else {await navigator.clipboard.writeText(location.href); const old=btn.textContent; btn.textContent='å·²è¤‡è£½'; setTimeout(()=>btn.textContent=old,1200);}
    }catch{const old=btn.textContent; btn.textContent='å–æ¶ˆ'; setTimeout(()=>btn.textContent=old,1000);}
  });
})();
['prev','next','page'].forEach(id=>{
  const el=document.getElementById(id); if(!el) return;
  const evt=id==='page'?'change':'click';
  el.addEventListener(evt,()=>window.scrollTo({top:0,behavior:'smooth'}));
});

/* ========= é™åˆ¶é ç¢¼åªèƒ½è¼¸å…¥æ•¸å­— ========= */
(function restrictPageInput(){
  const input = document.getElementById('page');
  if(!input) return;
  input.addEventListener('input', e=>{ e.target.value = e.target.value.replace(/[^0-9]/g, ''); });
  input.addEventListener('keydown', e=>{
    if(['Backspace','Delete','ArrowLeft','ArrowRight','Tab'].includes(e.key)) return;
    if(e.ctrlKey || e.metaKey) return;
    if(!/^[0-9]$/.test(e.key)) e.preventDefault();
  });
  input.addEventListener('paste', e=>{
    e.preventDefault();
    const txt=(e.clipboardData || window.clipboardData).getData('text');
    const clean=txt.replace(/[^0-9]/g,'');
    document.execCommand('insertText', false, clean);
  });
})();

/* ========= æ‰‹æ©Ÿå½±ç‰‡æŠ½å±œï¼šç›®éŒ„æŒ‰éˆ•ã€åªå…è¨±æ“ä½œæ¸…å–®ã€é¸ç‰‡/é—œé–‰ ========= */
(function mobileVideoDrawer(){
  const header = document.querySelector('.video-controls.top');
  const list   = document.getElementById('v-list');
  if(!header || !list) return;

  // å»ºç«‹ã€Œç›®éŒ„ã€æŒ‰éˆ•ï¼ˆåœ¨ã€Œéš¨æ©Ÿå½±ç‰‡ã€å³å´ï¼‰
  if(!document.getElementById('v-toggle')){
    const btn = document.createElement('button');
    btn.id = 'v-toggle';
    btn.className = 'btn';
    btn.textContent = 'ç›®éŒ„';
    header.appendChild(btn);
    btn.addEventListener('click', openDrawer);
  }

  // é»æ¸…å–®ï¼ˆé¸ç‰‡ï¼‰â†’ è‡ªå‹•é—œé–‰ï¼›å³ä¸Šè§’ âœ– å€åŸŸäº¦å¯æ‰‹å‹•é—œé–‰ï¼ˆåµæ¸¬é ‚éƒ¨å³å´ï¼‰
  list.addEventListener('click', (e)=>{
    const rect = list.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    if (y <= 60 && x >= rect.width - 64){
      closeDrawer();
      return;
    }
    if (e.target.closest('[data-video]')){
      closeDrawer();
    }
  }, true);

  function openDrawer(){
    if(!document.getElementById('v-backdrop')){
      const bg = document.createElement('div');
      bg.id = 'v-backdrop';
      document.body.appendChild(bg);
      bg.addEventListener('click', closeDrawer);
      bg.addEventListener('wheel', e=>e.preventDefault(), {passive:false});
      ['touchmove','pointerdown'].forEach(ev=>bg.addEventListener(ev, e=>e.preventDefault(), {passive:false}));
    }
    document.body.classList.add('vlist-open');
  }
  function closeDrawer(){
    document.body.classList.remove('vlist-open');
    document.getElementById('v-backdrop')?.remove();
  }

  // å°ºå¯¸è®Šæ›´ç‚ºæ¡Œæ©Ÿæ™‚è‡ªå‹•é—œé–‰æŠ½å±œ
  window.matchMedia('(min-width: 769px)').addEventListener('change', e=>{
    if(e.matches) closeDrawer();
  });
})();

</script>
</body>
</html>