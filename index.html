<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>鹿 QA | 系統連線終端</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- 核心與防呆設定 --- */
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #02040a;
            color: white;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        /* --- CRT 螢幕濾鏡效果 --- */
        .crt-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 999;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.95; }
            50% { opacity: 0.92; }
            100% { opacity: 0.96; }
        }

        /* --- 背景 Canvas --- */
        #canvas-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
        }

        /* --- 玻璃面板 --- */
        .glass-console {
            position: relative;
            z-index: 10;
            width: 90%;
            max-width: 400px;
            padding: 40px 30px;
            background: rgba(10, 20, 35, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), inset 0 0 30px rgba(0, 200, 255, 0.05);
            text-align: center;
            transition: all 0.5s ease;
            overflow: hidden;
        }

        /* 邊角裝飾 */
        .corner {
            position: absolute;
            width: 15px; height: 15px;
            border: 2px solid #22d3ee;
            opacity: 0.6;
            transition: 0.4s;
        }
        .tl { top: 0; left: 0; border-right: 0; border-bottom: 0; }
        .tr { top: 0; right: 0; border-left: 0; border-bottom: 0; }
        .bl { bottom: 0; left: 0; border-right: 0; border-top: 0; }
        .br { bottom: 0; right: 0; border-left: 0; border-top: 0; }

        .glass-console.active {
            border-color: rgba(34, 211, 238, 0.5);
            box-shadow: 0 0 60px rgba(34, 211, 238, 0.2);
        }
        .glass-console.active .corner {
            width: 100%; height: 100%;
            opacity: 0.2;
            border-radius: 20px;
        }

        /* --- Glitch 文字特效 --- */
        .glitch-title {
            position: relative;
            display: inline-block;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        .glitch-title::before, .glitch-title::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000510;
        }
        
        .glitch-title::before {
            left: 2px;
            text-shadow: -1px 0 #ff00c1;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        
        .glitch-title::after {
            left: -2px;
            text-shadow: -1px 0 #00fff9;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim {
            0% { clip: rect(12px, 9999px, 5px, 0); }
            5% { clip: rect(74px, 9999px, 86px, 0); }
            10% { clip: rect(12px, 9999px, 86px, 0); }
            100% { clip: rect(62px, 9999px, 14px, 0); }
        }
        @keyframes glitch-anim2 {
            0% { clip: rect(62px, 9999px, 24px, 0); }
            5% { clip: rect(2px, 9999px, 6px, 0); }
            100% { clip: rect(42px, 9999px, 74px, 0); }
        }

        /* --- 頭像區 --- */
        .avatar-section {
            position: relative;
            width: 120px; height: 120px;
            margin: 0 auto 20px;
        }
        .avatar-img {
            width: 100%; height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.1);
            filter: grayscale(100%) brightness(0.5) contrast(1.2);
            transition: 0.5s;
        }
        .scanning-face .avatar-img {
            filter: grayscale(0%) brightness(1.1) contrast(1);
            border-color: #22d3ee;
            box-shadow: 0 0 30px rgba(34, 211, 238, 0.5);
        }

        .face-hud {
            position: absolute; inset: -10px;
            border: 1px dashed rgba(34, 211, 238, 0.6);
            border-radius: 50%; opacity: 0; transform: scale(0.8);
            transition: 0.3s;
        }
        .face-scan-beam {
            position: absolute; left: 0; width: 100%; height: 2px;
            background: #22d3ee; box-shadow: 0 0 15px #22d3ee;
            opacity: 0; z-index: 5;
        }
        .scanning-face .face-hud { opacity: 1; transform: scale(1) rotate(180deg); animation: spin 4s linear infinite; }
        .scanning-face .face-scan-beam { opacity: 1; animation: scan 1.5s ease-in-out infinite; }

        /* --- 指紋區 (高擬真版 - Updated) --- */
        .fingerprint-section {
            position: relative; width: 100px; height: 100px; margin: 10px auto;
            cursor: pointer; padding: 10px;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
            overflow: hidden; /* 確保掃描線不跑出去 */
            border-radius: 50%; /* 圓形遮罩 */
        }
        .fingerprint-section:active { transform: scale(0.95); }
        
        /* 指紋 SVG 設定 */
        .fingerprint-svg {
            width: 100%; height: 100%;
            fill: none; /* 不填充 */
            stroke: rgba(255, 255, 255, 0.3); /* 預設灰線 */
            stroke-width: 2.5; /* 線條粗細 */
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: 0.4s ease;
            filter: drop-shadow(0 0 2px rgba(255,255,255,0.1));
        }
        
        /* 啟動掃描時的樣式 */
        .is-scanning .fingerprint-svg {
            stroke: #ec4899; /* 變成粉紅色 */
            filter: drop-shadow(0 0 8px #ec4899);
            animation: pulse-finger 1.5s infinite alternate;
        }

        /* 外圈進度環 */
        .ring-svg {
            position: absolute; inset: -5px; width: 130px; height: 130px;
            transform: rotate(-90deg); pointer-events: none; z-index: 10;
        }
        .ring-circle {
            fill: none; stroke: #ec4899; stroke-width: 3; stroke-linecap: round;
            stroke-dasharray: 408; stroke-dashoffset: 408; transition: stroke-dashoffset 0.1s linear;
        }

        /* 內部掃描光條 (新功能) */
        .scan-line {
            position: absolute; width: 100%; height: 4px;
            background: #22d3ee;
            box-shadow: 0 0 10px #22d3ee, 0 0 20px #22d3ee;
            top: -10%; opacity: 0;
            z-index: 5;
            transition: opacity 0.2s;
        }
        
        /* 按下時觸發掃描光條 */
        .is-scanning .scan-line {
            opacity: 1;
            animation: fingerprint-scan 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .scan-complete .fingerprint-section {
            transform: scale(0); opacity: 0; height: 0; padding: 0; margin: 0;
        }

        @keyframes pulse-finger {
            0% { opacity: 0.7; }
            100% { opacity: 1; text-shadow: 0 0 20px #ec4899; }
        }

        @keyframes fingerprint-scan {
            0% { top: 0%; }
            50% { top: 100%; }
            100% { top: 0%; }
        }

        /* --- 進度條區 --- */
        .loader-section {
            height: 0; opacity: 0; overflow: hidden; transition: 0.5s;
        }
        .loader-visible .loader-section { height: auto; opacity: 1; margin-top: 20px; }
        .progress-track {
            width: 100%; height: 6px; background: rgba(255,255,255,0.1);
            border-radius: 10px; overflow: hidden; margin-top: 5px;
        }
        .progress-fill {
            width: 0%; height: 100%;
            background: linear-gradient(90deg, #22d3ee, #a78bfa, #ec4899);
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.7);
            transition: width 0.1s linear;
        }

        /* --- 通用動畫 --- */
        @keyframes spin { 100% { transform: scale(1) rotate(360deg); } }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        .blink { animation: blinker 0.2s infinite alternate; }
        @keyframes blinker { from { opacity: 1; } to { opacity: 0.4; } }

        .skip-btn {
            margin-top: 30px; color: rgba(255,255,255,0.3); font-size: 12px; letter-spacing: 2px;
            transition: 0.3s; cursor: pointer;
        }
        .skip-btn:hover { color: white; text-shadow: 0 0 8px white; }

    </style>
</head>
<body>

    <div class="crt-overlay"></div>

    <canvas id="canvas-bg"></canvas>

    <div class="glass-console" id="console-panel">
        <div class="corner tl"></div><div class="corner tr"></div>
        <div class="corner bl"></div><div class="corner br"></div>

        <h1 class="text-3xl font-black text-white mb-2 tracking-widest glitch-title" data-text="鹿 QA 網站">鹿 QA 網站</h1>
        <p class="text-xs text-cyan-400 font-bold tracking-[0.4em] mb-6 opacity-80">麋鹿專用安全連結</p>

        <div class="avatar-section" id="avatar-section">
            <div class="face-hud"></div>
            <div class="face-scan-beam"></div>
            <img src="./icon.png" 
                 onerror="this.src='https://ui-avatars.com/api/?name=Deer&background=0D8ABC&color=fff&size=128&font-size=0.4'" 
                 alt="鹿頭像" class="avatar-img">
        </div>

        <div id="status-text" class="text-gray-400 text-sm font-mono min-h-[24px] mb-4">
            請長按指紋啟動驗證程序...
        </div>

        <div class="fingerprint-section" id="fp-btn">
            <svg class="ring-svg"><circle class="ring-circle" cx="65" cy="65" r="65" id="fp-ring"></circle></svg>
            
            <div class="scan-line"></div>

            <svg class="fingerprint-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M50,92.5 C26.5,92.5 7.5,73.5 7.5,50 C7.5,26.5 26.5,7.5 50,7.5 C73.5,7.5 92.5,26.5 92.5,50 C92.5,73.5 73.5,92.5 50,92.5 M50,15 C30.7,15 15,30.7 15,50 C15,69.3 30.7,85 50,85 C69.3,85 85,69.3 85,50 C85,30.7 69.3,15 50,15 M50,22.5 C65.2,22.5 77.5,34.8 77.5,50 C77.5,55.5 75.8,60.6 73,64.8 M27,64.8 C24.2,60.6 22.5,55.5 22.5,50 C22.5,34.8 34.8,22.5 50,22.5 M50,30 C39,30 30,39 30,50 C30,53.8 31,57.4 32.8,60.5 M67.2,60.5 C69,57.4 70,53.8 70,50 C70,39 61,30 50,30 M50,37.5 C56.9,37.5 62.5,43.1 62.5,50 C62.5,52.3 61.9,54.5 60.8,56.4 M39.2,56.4 C38.1,54.5 37.5,52.3 37.5,50 C37.5,43.1 43.1,37.5 50,37.5 M50,45 C47.2,45 45,47.2 45,50 C45,51.1 45.4,52.1 46,52.9 M54,52.9 C54.6,52.1 55,51.1 55,50 C55,47.2 52.8,45 50,45" />
                <path d="M50,78 C40,78 31.5,73 26,65.5" stroke-dasharray="10,5" opacity="0.8"/>
                <path d="M74,65.5 C68.5,73 60,78 50,78" stroke-dasharray="10,5" opacity="0.8"/>
            </svg>
        </div>

        <div class="loader-section" id="loader-sect">
            <div class="flex justify-between text-xs text-cyan-300 px-1">
                <span>系統資源同步中</span>
                <span id="pct">0%</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="fill"></div>
            </div>
        </div>

        <div onclick="redirect()" class="skip-btn">[ 跳過動畫直接進入 ]</div>
    </div>

    <script>
        const NEW_URL = "https://wangleoncom.github.io/ldweb";
        
        // 變數參考
        const ui = {
            panel: document.getElementById('console-panel'),
            fpBtn: document.getElementById('fp-btn'),
            fpRing: document.getElementById('fp-ring'),
            status: document.getElementById('status-text'),
            avatar: document.getElementById('avatar-section'),
            loader: document.getElementById('loader-sect'),
            fill: document.getElementById('fill'),
            pct: document.getElementById('pct')
        };

        // 狀態管理
        let state = { holding: false, progress: 0, stage: 0 }; 
        let animFrame;

        // 初始化圓環
        const CIRCUMFERENCE = 408;
        ui.fpRing.style.strokeDasharray = `${CIRCUMFERENCE} ${CIRCUMFERENCE}`;
        ui.fpRing.style.strokeDashoffset = CIRCUMFERENCE;

        // 核心流程
        function startHold(e) {
            if(state.stage !== 0) return;
            e.preventDefault();
            state.holding = true;
            ui.fpBtn.classList.add('is-scanning'); // 觸發 CSS 的 is-scanning 樣式
            ui.status.innerText = "生物特徵擷取中...";
            ui.status.style.color = "#ec4899";
            if(navigator.vibrate) navigator.vibrate(30);
            loopFingerprint();
        }

        function stopHold() {
            if(state.stage !== 0) return;
            state.holding = false;
            cancelAnimationFrame(animFrame);
            ui.fpBtn.classList.remove('is-scanning');

            if (state.progress < 100) {
                ui.status.innerText = "驗證中斷，請保持長按";
                ui.status.style.color = "#ef4444";
                let retreat = setInterval(() => {
                    state.progress -= 4;
                    if(state.progress <= 0) {
                        state.progress = 0;
                        ui.status.innerText = "請長按指紋啟動驗證...";
                        ui.status.style.color = "#9ca3af";
                        clearInterval(retreat);
                    }
                    updateRing(state.progress);
                }, 10);
            }
        }

        function loopFingerprint() {
            if(!state.holding) return;
            state.progress += 1.8; 
            updateRing(state.progress);

            if(state.progress >= 100) {
                state.stage = 1; 
                successFingerprint();
            } else {
                animFrame = requestAnimationFrame(loopFingerprint);
            }
        }

        function updateRing(p) {
            const offset = CIRCUMFERENCE - (p / 100) * CIRCUMFERENCE;
            ui.fpRing.style.strokeDashoffset = offset;
        }

        function successFingerprint() {
            if(navigator.vibrate) navigator.vibrate([50, 50, 50]);
            ui.status.innerText = "指紋確認：符合麋鹿特徵";
            ui.status.style.color = "#22d3ee";
            ui.panel.classList.add('scan-complete', 'active');
            setTimeout(startFaceScan, 800);
        }

        function startFaceScan() {
            ui.status.innerText = "啟動鹿臉部識別掃描...";
            ui.avatar.classList.add('scanning-face');
            
            const msgs = [
                "正在解析生物鹿角特徵...", 
                "加密連線至麋鹿中樞...", 
                "權限獲取：核心麋鹿成員"
            ];
            let idx = 0;

            let interval = setInterval(() => {
                if(idx < msgs.length) {
                    ui.status.innerText = msgs[idx];
                    ui.status.classList.add('blink');
                    setTimeout(() => ui.status.classList.remove('blink'), 200);
                    idx++;
                    if(navigator.vibrate) navigator.vibrate(20);
                } else {
                    clearInterval(interval);
                    finishFaceScan();
                }
            }, 900);
        }

        function finishFaceScan() {
            ui.status.innerText = "身分驗證完全通過！";
            ui.status.style.color = "#10b981";
            if(navigator.vibrate) navigator.vibrate(100);
            setTimeout(startLoading, 600);
        }

        function startLoading() {
            state.stage = 2;
            document.body.classList.add('loader-visible');
            ui.status.innerText = "正在初始化系統...";
            ui.status.style.color = "white";

            let p = 0;
            let timer = setInterval(() => {
                p += Math.random() * 6;
                if(p >= 100) {
                    p = 100;
                    clearInterval(timer);
                    ui.status.innerText = "傳送中...";
                    setTimeout(redirect, 400);
                }
                ui.fill.style.width = p + "%";
                ui.pct.innerText = Math.floor(p) + "%";
            }, 80);
        }

        function redirect() {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 1s';
            setTimeout(() => window.location.replace(NEW_URL), 1000);
        }

        // 事件監聽
        const btn = ui.fpBtn;
        btn.addEventListener('mousedown', startHold);
        btn.addEventListener('touchstart', startHold);
        window.addEventListener('mouseup', stopHold);
        window.addEventListener('touchend', stopHold);

        // --- 背景 Canvas ---
        const cvs = document.getElementById('canvas-bg');
        const ctx = cvs.getContext('2d');
        let parts = [];

        function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        class P {
            constructor() {
                this.x = Math.random() * cvs.width;
                this.y = Math.random() * cvs.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.size = Math.random() * 2;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if(this.x<0 || this.x>cvs.width) this.vx *= -1;
                if(this.y<0 || this.y>cvs.height) this.vy *= -1;
            }
            draw() {
                ctx.fillStyle = 'rgba(100,200,255,0.3)';
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill();
            }
        }
        
        for(let i=0; i<60; i++) parts.push(new P());

        function anim() {
            ctx.clearRect(0,0,cvs.width,cvs.height);
            parts.forEach((p, i) => {
                p.update(); p.draw();
                for(let j=i; j<parts.length; j++) {
                    const dx = parts[i].x - parts[j].x;
                    const dy = parts[i].y - parts[j].y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < 120) {
                        ctx.strokeStyle = `rgba(100,200,255,${0.1 - dist/1200})`;
                        ctx.beginPath(); ctx.moveTo(parts[i].x, parts[i].y); ctx.lineTo(parts[j].x, parts[j].y); ctx.stroke();
                    }
                }
            });
            requestAnimationFrame(anim);
        }
        anim();

        history.pushState(null, "", location.href);
        window.onpopstate = () => { history.pushState(null, "", location.href); redirect(); };
    </script>
</body>
</html>
